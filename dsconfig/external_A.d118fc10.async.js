(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[0],{"1QTu":function(e,t,n){"use strict";n.r(t);var a=n("rePB"),r=n("ODXe"),o=n("q1tI"),i=n.n(o),c=n("TSYQ"),l=n.n(c),s=(n("5NDa"),n("5rEg")),u=n("lxOd"),d=n("9kvl"),p=n("bsjA"),f=n.n(p),m=s["a"].Search,g=Object(d["b"])((function(e){var t=Object(o["useState"])(""),n=Object(r["a"])(t,2),a=n[0],c=n[1],l=Object(d["e"])("entity-metadata-loader"),s=l.loadEntityList,p=l.setKeyword,g=l.accessToken,h=l.dataSource,v=Object(u["a"])((function(e){e&&s({keyword:e,dataSource:h,accessToken:g})}),{wait:500}),b=v.run;return i.a.createElement("div",{className:f.a.searchInput},i.a.createElement(m,{className:f.a.input,placeholder:e.intl.formatMessage({id:"control.input.search.plc"}),value:a,allowClear:!0,onChange:function(e){var t=e.target.value;t||p(""),c(t)},onSearch:b}))})),h=n("ET/R"),v=(n("T2oS"),n("W9HT")),b=n("VTBJ"),E=n("t73O"),y=n("U+PY"),O=n("DlQD"),_=n.n(O),x=n("jkD3"),j=n("x91h"),S=n("8IqU"),w=n.n(S),N=function(e){var t=e.left,n=e.right,a=void 0===n?0:n,r=e.max,c=e.children,l=Object(o["useCallback"])((function(){var e=c.length,n="...",o="",i="";return e>r?(o=t&&e?c.substr(0,t):c.substr(0,r),a&&(i=c.substr(-a,a)),"".concat(o).concat(n).concat(i)):c}),[t,a,r,c]);return i.a.createElement("span",{className:w.a["no-wrap"]},l())},k=n("IfPK"),M=n.n(k),C=function(e){var t=e.raw,n=e.keyword,r=e.className;if(n){var o,c=new RegExp(n,"ig"),s=t.split(c);return i.a.createElement("span",{className:l()((o={},Object(a["a"])(o,M.a.keywordWrapper,!0),Object(a["a"])(o,r,!!r),o))},s.map((function(e,t){return t!==s.length-1?i.a.createElement("span",{key:e+t},e,i.a.createElement("strong",null,n)):e})))}return null},I=function(e){var t=e.data,n=t.keyword,a=t.cutParas,r=void 0===a?{}:a,o=Object(j["a"])(t.name),c=r.max,l=r.side;return n?i.a.createElement(C,{raw:o,keyword:n}):c?i.a.createElement(N,{max:c,left:l,right:l},o):i.a.createElement("span",null,o)},D=n("ajgr"),R=n("GPkh"),T=n.n(R),P=n("okkz");_.a.setOptions({gfm:!0,breaks:!0});var F=function(e){var t=e.data,n=e.connectDragPreview,r=e.connectDragSource,o=t.name,c=t.entityType;return i.a.createElement("div",null,n(r(i.a.createElement("span",{className:l()(T.a.nodeItem,Object(a["a"])({},T.a.orange,c===P["a"].ODataEntity))},i.a.createElement(y["a"],{className:T.a.nodeIcon}),i.a.createElement(I,{data:{name:o}})))))},A=Object(x["a"])(D["a"],{beginDrag:function(e){return{component:{entity:e.data}}}},(function(e,t){return{connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),isDragging:t.isDragging()}}))(F),G=function(e){var t=e.data,n=void 0===t?{}:t;return i.a.createElement("div",{className:T.a.itemBlock},i.a.createElement(A,{data:n}))},L=n("Qf5C"),z=n.n(L),B=function(){var e=Object(d["e"])("entity-metadata-loader"),t=e.keyword,n=e.entityList,a=e.loading,r=Object(o["useCallback"])((function(e,t){return i.a.createElement("ul",{className:z.a.searchList},e.map((function(e,n){return i.a.createElement("li",{key:n.toString()},i.a.createElement(G,{data:Object(b["a"])(Object(b["a"])({},e),{},{keyword:t})}))})))}),[]),c=Object(o["useCallback"])((function(){return i.a.createElement(i.a.Fragment,null,i.a.createElement("p",{className:z.a.resultTips},i.a.createElement(E["a"],null),"No Result"))}),[]);return i.a.createElement(v["a"],{spinning:a},i.a.createElement("div",{className:"tree-wrapper"},n.length?r(n,t):c()))},q=n("7i6x"),V=n.n(q),K=function(){var e=Object(d["e"])("entity-metadata-loader"),t=e.keyword,n=e.dataSource,a=e.accessToken,r=e.loadEntityList;return Object(h["a"])((function(){r({keyword:t,dataSource:n,accessToken:a})})),i.a.createElement("div",{className:V.a.componentTree},i.a.createElement(B,null))},$=n("YY5l"),U=n.n($),W=function(e){var t=e.className;return i.a.createElement("div",{className:l()(t,U.a.componentSourceTree)},i.a.createElement("div",{className:U.a.component},i.a.createElement(g,null),i.a.createElement(K,null)),i.a.createElement("div",{className:U.a.links}))},Y=n("K96N"),Q=n.n(Y),X=function(e){var t=e.className,n=e.intl,c=Object(o["useState"])("component"),s=Object(r["a"])(c,2),u=s[0],d=s[1];return i.a.createElement("div",{className:l()(t,Q.a.nodeSourceTreeContainer),hidden:e.hidden},i.a.createElement("div",{className:Q.a.tabWrapper},i.a.createElement("div",{className:l()(Q.a.tab,Object(a["a"])({},Q.a.active,"component"===u)),onClick:function(){d("component")}},n.formatMessage({id:"control.tab.datatable.title"}))),i.a.createElement("div",{className:Q.a.tabContentWrapper},i.a.createElement(W,{className:l()(Object(a["a"])({},Q.a.hide,"component"!==u))})))};t["default"]=Object(d["b"])(X)},"5Bhb":function(e,t,n){e.exports={footer:"footer___2cSQ_",headerLeft:"headerLeft___3PUCV",headerRight:"headerRight___3RHAE",logo:"logo___1L-Br"}},"7i6x":function(e,t,n){e.exports={componentTree:"componentTree___1Zc9b"}},"8IqU":function(e,t,n){e.exports={"no-wrap":"no-wrap___1HpSW"}},"97KR":function(e,t,n){e.exports={dagContainer:"dagContainer___3tdOn",canvasContent:"canvasContent___u62p1","processing-line":"processing-line___civhW"}},"9lW8":function(e,t,n){e.exports={canvasToolbar:"canvasToolbar___1b2T-",searchItem:"searchItem___21BBF",searchWrapper:"searchWrapper___1P9Ai",search:"search___k-caM",expansion:"expansion___2YG-j",searchResult:"searchResult___tvOtb",hide:"hide___lXVs5",searchResultItem:"searchResultItem___14u0o"}},CtPC:function(e,t,n){e.exports={graphContextMenu:"graphContextMenu___GiwvD",loadDataSourceModal:"loadDataSourceModal___2cMbc",versionTable:"versionTable___2GMod",operations:"operations___Q0WsO"}},GPkh:function(e,t,n){e.exports={nodeItem:"nodeItem___tP_79",itemBlock:"itemBlock___2QLzm",nodeIcon:"nodeIcon___22Mov",itemLable:"itemLable___3m6bq",gre:"gre___QGu_w",catLable:"catLable___390U1",description:"description___2LqM4",link:"link___2iITB",componentDescription:"componentDescription___17g79",statusTips:"statusTips___2Jq2R",tag:"tag___6Wvw1",label:"label___3mo5U"}},IfPK:function(e,t,n){e.exports={keywordWrapper:"keywordWrapper___1EQlS"}},K96N:function(e,t,n){e.exports={nodeSourceTreeContainer:"nodeSourceTreeContainer___262YV",tabWrapper:"tabWrapper___2lXyB",tab:"tab___XegkF",active:"active___fBoyk",tabContentWrapper:"tabContentWrapper___JQT4-",hide:"hide___2wDSq"}},MgPD:function(e,t,n){"use strict";n.d(t,"b",(function(){return ve})),n.d(t,"a",(function(){return be})),n.d(t,"c",(function(){return Ee}));n("miYZ");var a=n("tsqr"),r=n("KQm4"),o=n("VTBJ"),i=n("o0o1"),c=n.n(i),l=n("HaE+"),s=(n("+L6B"),n("2/Rp")),u=(n("GNNt"),n("wEI+")),d=(n("5Dmo"),n("3S7+")),p=n("1OyB"),f=n("vuIU"),m=n("JX7q"),g=n("Ji7U"),h=n("LK+K"),v=n("ReuC"),b=n("foSv"),E=n("q1tI"),y=n.n(E),O=n("i8i4"),_=n.n(O),x="ant",j=n("TSYQ"),S=n.n(j),w=n("26FU"),N=n("kERW"),k=n("VnD/"),M=n("t9fZ"),C=n("LvDl"),I=n("rfrl"),D=n("eFNv"),R=n("ajgr"),T=n("ODXe"),P=n("Ff2n"),F=n("VygY"),A=n("p0ib"),G=n("xMyE"),L=n("dC0D"),z=n("Gi3i"),B=n("67Y/");n("uzJG");function q(e,t){e.forEach((function(e){var n=e.getData()||{};e.setData(Object(o["a"])(Object(o["a"])({},n),{},{selected:t}))}))}var V=function(){function e(t){var n=this;Object(p["a"])(this,e),this.wrapper=void 0,this.container=void 0,this.nodeMetas=void 0,this.edgeMetas=void 0,this.options=void 0,this.graph=void 0,this.contextMenuInfo$=new w["a"](null),this.selectedNodes$=new w["a"]([]),this.deleteNodeOrEdge$=new w["a"]({nodes:[],edges:[]}),this.copyableNodeId$=new w["a"](""),this.windowResizeSub=void 0,this.contextMenuSub=void 0,this.nodeContextMenuSub=void 0,this.selectNodeSub=void 0,this.connectNodeSub=void 0,this.connectionRemovedSub=void 0,this.moveNodesSub=void 0,this.deleteNodeOrEdgeSub=void 0,this.copyNodeSub=void 0,this.resizeGraph=function(){var e=n.graph,t=n.wrapper;e&&t&&requestAnimationFrame((function(){var n=t.clientWidth,a=t.clientHeight;e.resize(n,a)}))},this.addNode=function(e){var t;return null===(t=n.nodeMetas)||void 0===t||t.push(e),n.renderNode(e)},this.addEdge=function(e){var t;return null===(t=n.edgeMetas)||void 0===t||t.push(e),n.renderEdge(e)},this.getNodeById=function(e){var t,a=null===(t=n.graph)||void 0===t?void 0:t.getCellById(e);if(null===a||void 0===a?void 0:a.isNode())return a},this.getNodes=function(){var e;return(null===(e=n.graph)||void 0===e?void 0:e.getNodes())||[]},this.getEdgeById=function(e){var t,a=null===(t=n.graph)||void 0===t?void 0:t.getCellById(e);if(null===a||void 0===a?void 0:a.isEdge())return a},this.getEdges=function(){var e;return(null===(e=n.graph)||void 0===e?void 0:e.getEdges())||[]},this.changeNodeHeight=function(e,t){var a=n.getNodeById(e),r=null===a||void 0===a?void 0:a.getBBox();r&&(null===a||void 0===a||a.resize(r.width,t))},this.getCellById=function(e){var t,a=null===(t=n.graph)||void 0===t?void 0:t.getCellById(e);if((null===a||void 0===a?void 0:a.isNode())||(null===a||void 0===a?void 0:a.isEdge()))return a},this.getCells=function(){var e;return(null===(e=n.graph)||void 0===e?void 0:e.getCells())||[]},this.updateNodeById=function(e,t){t(n.getNodeById(e))},this.updateNodes=function(e){e(n.getNodes())},this.updateEdgeById=function(e,t){var a,r=null===(a=n.graph)||void 0===a?void 0:a.getCellById(e);(null===r||void 0===r?void 0:r.isEdge())?t(r):t(void 0)},this.updateEdges=function(e){var t,a=(null===(t=n.graph)||void 0===t?void 0:t.getEdges())||[];e(a)},this.deleteNodes=function(e){var t,a=[].concat(e);n.nodeMetas=n.nodeMetas.filter((function(e){return!a.includes(e.id)})),null===(t=n.graph)||void 0===t||t.removeCells(a)},this.deleteEdges=function(e){var t,a=[].concat(e),r=a.map((function(e){return"string"===typeof e?e:e.id}));n.edgeMetas=n.edgeMetas.filter((function(e){return!r.includes(e.id)})),null===(t=n.graph)||void 0===t||t.removeCells(a)},this.clearContextMenuInfo=function(){n.contextMenuInfo$.next(null)},this.zoom=function(e){var t;if("number"===typeof e)null===(t=n.graph)||void 0===t||t.zoom(e);else if("fit"===e){var a;null===(a=n.graph)||void 0===a||a.zoomToFit({padding:12})}else if("real"===e){var r,o;null===(r=n.graph)||void 0===r||r.scale(1),null===(o=n.graph)||void 0===o||o.centerContent()}},this.toggleSelectionEnabled=function(e){var t=n.graph;if(t){var a="undefined"===typeof e?!t.isRubberbandEnabled():e;a?t.enableRubberband():t.disableRubberband()}},this.selectNodes=function(e){var t=n.graph;if(t){var a=[].concat(e).map((function(e){return e.toString()}));if(t.cleanSelection(),t.select(a),!Array.isArray(e)){var r=t.getCellById(e);t.scrollToCell(r)}}},this.unSelectNode=function(){var e=n.graph;e&&e.cleanSelection()},this.redo=function(){var e=n.graph;e&&e.redo()},this.undo=function(){var e=n.graph;e&&e.undo()},this.setCopyableNodeId=function(e){n.copyableNodeId$.next(e)},this.throwRenderError=function(){if(!n.wrapper)throw new Error("Wrapper element is needed.");if(!n.container)throw new Error("Container element is needed.");if(!n.nodeMetas)throw new Error("NodeMetas could not be empty");if(!n.edgeMetas)throw new Error("EdgeMetas could not be empty")};t.wrapper,t.container,t.nodes,t.edges;var a=Object(P["a"])(t,["wrapper","container","nodes","edges"]);this.setMeta(t),this.options=a}return Object(f["a"])(e,[{key:"setMeta",value:function(e){var t=e.wrapper,n=e.container,a=e.nodes,r=e.edges;t&&this.setWrapper(t),n&&this.setContainer(n),a&&this.setNodes(a),r&&this.setEdges(r)}},{key:"setWrapper",value:function(e){this.wrapper=e}},{key:"setContainer",value:function(e){this.container=e,this.options.container=e}},{key:"setNodes",value:function(e){this.nodeMetas=e}},{key:"setEdges",value:function(e){this.edgeMetas=e}},{key:"render",value:function(e){var t=this;if(this.setMeta(e),this.isMetaValid){var n=this.wrapper,a=this.options,r=this.nodeMetas,i=this.edgeMetas,c=n.clientWidth,l=n.clientHeight,s=new F["d"](Object(o["a"])(Object(o["a"])({},a),{},{width:c,height:l}));this.graph=s,r.forEach((function(e){return t.renderNode(e)})),i.forEach((function(e){return t.renderEdge(e)})),this.afterLayout(),s.isFrozen()&&s.unfreeze(),requestAnimationFrame((function(){s.centerContent()})),this.windowResizeSub=Object(N["a"])((function(e){window.addEventListener("resize",e)}),(function(e){window.removeEventListener("resize",e)})).subscribe(this.resizeGraph);var u=Object(N["a"])((function(e){s.on("node:contextmenu",(function(t){e({type:"node",data:t})}))}),(function(e){s.off("node:contextmenu",e)})),d=Object(N["a"])((function(e){s.on("edge:contextmenu",(function(t){e({type:"edge",data:t})}))}),(function(e){s.off("edge:contextmenu",e)})),p=Object(N["a"])((function(e){s.on("blank:contextmenu",(function(t){e({type:"graph",data:t})}))}),(function(e){s.off("edge:contextmenu",e)}));this.nodeContextMenuSub=u.subscribe((function(e){t.onNodeContextMenu(e)})),this.contextMenuSub=Object(A["a"])(u,d,p).subscribe((function(e){t.validateContextMenu(e)&&(t.contextMenuInfo$.next(e),t.onContextMenu(e))})),this.selectNodeSub=Object(N["a"])((function(e){s.on("selection:changed",e)}),(function(e){s.off("selection:changed",e)})).subscribe((function(e){var n=e.removed,a=e.selected;q(n,!1),q(a,!0),t.onSelectNodes(a)})),this.connectNodeSub=Object(N["a"])((function(e){s.on("edge:connected",e)}),(function(e){s.off("edge:connected",e)})).subscribe((function(e){t.onConnectNode(e)})),this.connectionRemovedSub=Object(N["a"])((function(e){s.on("edge:removed",e)}),(function(e){s.off("edge:removed",e)})).subscribe((function(e){t.onConnectionRemoved(e)}));var f=!1;this.moveNodesSub=Object(N["a"])((function(e){s.on("node:change:position",e)}),(function(e){s.off("node:change:position",e)})).pipe(Object(G["a"])((function(e){t.onMoveNodeStart(e)})),Object(L["a"])((function(e,t){var n=f?e:[],a=t.node,r=a.id,o=n.findIndex((function(e){return e.id===r}));return o>-1?n.splice(o,1,{id:r,data:t}):n.push({id:r,data:t}),n}),[]),Object(G["a"])((function(){f||(f=!0)})),Object(z["a"])(300),Object(G["a"])((function(){f&&(f=!1)})),Object(B["a"])((function(e){return e.map((function(e){return e.data}))}))).subscribe((function(e){t.onMoveNodes(e)})),this.deleteNodeOrEdgeSub=Object(N["a"])((function(e){s.bindKey(["delete","backspace"],e)}),(function(){s.unbindKey(["delete","backspace"])})).subscribe((function(){var e=s.getSelectedCells(),n=e.filter((function(e){return e.isNode()})),a=e.filter((function(e){return e.isEdge()}));t.onDeleteNodeOrEdge({nodes:n,edges:a})})),this.copyNodeSub=Object(N["a"])((function(e){s.bindKey(["command+c","ctrl+c","command+v","ctrl+v"],e)}),(function(){s.unbindKey(["command+c","ctrl+c","command+v","ctrl+v"])})).subscribe((function(e){var n,a=Object(T["a"])(e,2),r=a[1],o=s.getSelectedCells().filter((function(e){return t.validateNodeCopyable(e)})),i=t.copyableNodeId$.getValue();switch(i&&(n=s.getCellById(i)),r){case"command+c":case"ctrl+c":(null===o||void 0===o?void 0:o.length)&&t.setCopyableNodeId(o[0].id);break;case"command+v":case"ctrl+v":n&&t.onCopyNode(n);break;default:}}))}else this.throwRenderError()}},{key:"renderNode",value:function(e){return this.graph.addNode(e)}},{key:"renderEdge",value:function(e){return this.graph.addEdge(e)}},{key:"afterLayout",value:function(){0}},{key:"validateContextMenu",value:function(e){return!!e}},{key:"onContextMenu",value:function(e){0}},{key:"onNodeContextMenu",value:function(e){0}},{key:"onSelectNodes",value:function(e){this.selectedNodes$.next(e)}},{key:"onConnectNode",value:function(e){0}},{key:"onConnectionRemoved",value:function(e){0}},{key:"onMoveNodeStart",value:function(e){0}},{key:"onMoveNodes",value:function(e){0}},{key:"onDeleteNodeOrEdge",value:function(e){0}},{key:"validateNodeCopyable",value:function(e){return!0}},{key:"onCopyNode",value:function(e){0}},{key:"dispose",value:function(){var e,t,n,a,r,o,i,c,l;if(null===(e=this.windowResizeSub)||void 0===e||e.unsubscribe(),null===(t=this.contextMenuSub)||void 0===t||t.unsubscribe(),null===(n=this.nodeContextMenuSub)||void 0===n||n.unsubscribe(),null===(a=this.selectNodeSub)||void 0===a||a.unsubscribe(),null===(r=this.connectNodeSub)||void 0===r||r.unsubscribe(),null===(o=this.connectionRemovedSub)||void 0===o||o.unsubscribe(),null===(i=this.moveNodesSub)||void 0===i||i.unsubscribe(),null===(c=this.deleteNodeOrEdgeSub)||void 0===c||c.unsubscribe(),null===(l=this.copyNodeSub)||void 0===l||l.unsubscribe(),this.wrapper){var s,u=this.wrapper.querySelector(".x6-graph-scroller");u&&(u.innerHTML="",u.setAttribute("style",""),u.setAttribute("class",""),this.container&&(this.container.innerHTML="",this.container.setAttribute("style",""),this.container.setAttribute("class",""))),null===(s=this.graph)||void 0===s||s.dispose()}}},{key:"isMetaValid",get:function(){var e=this.wrapper,t=this.container,n=this.nodeMetas,a=this.edgeMetas;return!!e&&!!t&&!!n&&!!a}},{key:"nodes",get:function(){var e;return(null===(e=this.graph)||void 0===e?void 0:e.getNodes())||[]}}]),e}(),K=n("m6rN"),$=function(e){Object(g["a"])(n,e);var t=Object(h["a"])(n);function n(){return Object(p["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n,[{key:"isGroup",value:function(){return!1}}]),n}(K["a"]),U=function(e){Object(g["a"])(n,e);var t=Object(h["a"])(n);function n(){return Object(p["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n,[{key:"getInPorts",value:function(){return this.getPortsByGroup("in")}},{key:"getOutPorts",value:function(){return this.getPortsByGroup("out")}}]),n}($);F["f"].registry.register("ais-rect-port",U),U.config({width:R["f"],height:R["d"],shape:"ais-rect-port",ports:{groups:{in:{position:{name:"top"},zIndex:2},leftin:{position:{name:"left"},zIndex:2},out:{position:{name:"bottom"},zIndex:2},rightout:{position:{name:"right"},zIndex:2}}},attrs:{body:{magnet:!1,fill:"none",stroke:"none",refWidth:"100%",refHeight:"100%",zIndex:1}},portMarkup:[{tagName:"foreignObject",selector:"fo",attrs:{width:6,height:6,x:-3,y:-3,zIndex:10,magnet:"true"},children:[{ns:F["a"].ns.xhtml,tagName:"body",selector:"foBody",attrs:{xmlns:F["a"].ns.xhtml},style:{width:"100%",height:"100%"},children:[{tagName:"span",selector:"content",style:{width:"100%",height:"100%"}}]}]}]});n("WEsZ");var W=function(e){Object(g["a"])(n,e);var t=Object(h["a"])(n);function n(){return Object(p["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n,[{key:"isGroupEdge",value:function(){return!1}}]),n}(F["j"].Edge),Y=function(e){Object(g["a"])(n,e);var t=Object(h["a"])(n);function n(){return Object(p["a"])(this,n),t.apply(this,arguments)}return n}(W);Y.config({shape:"GuideEdge",connector:{name:"pai"},zIndex:2,attrs:{line:{stroke:"#808080",strokeWidth:1,sourceMarker:{name:"diamond"},targetMarker:{name:"classic"}}},defaultLabel:{markup:F["e"].getForeignObjectMarkup(),attrs:{fo:{width:30,height:30,x:-15,y:-15}}},label:{position:.5}}),F["b"].registry.register({GuideEdge:Y});var Q=n("BvK0"),X=n("jF/p"),J=n("1myf");function H(e){var t=e.moveNodes,n=[];t.forEach((function(e){var t=e.getParent();t&&!n.includes(t)&&n.push(t)})),n.forEach((function(e){var t=e.getSize(),n=e.getPosition(),a=n.x,r=n.y,o=t.width,i=t.height,c=e.getChildren(),l=c.filter((function(e){return e.isNode()}));if(null===l||void 0===l?void 0:l.length){var s,u,d,p,f=l.map((function(e){return e.getPosition()})),m=null===(s=Object(Q["a"])(f,"x"))||void 0===s?void 0:s.x,g=null===(u=Object(Q["a"])(f,"y"))||void 0===u?void 0:u.y,h=null===(d=Object(X["a"])(f,"x"))||void 0===d?void 0:d.x,v=null===(p=Object(X["a"])(f,"y"))||void 0===p?void 0:p.y,b=m-R["b"],E=g-R["c"],y=h-m+2*R["b"]+R["f"],O=v-g+2*R["c"]+R["d"];a===b&&r===E&&o===y&&i===O||e.prop({position:{x:b,y:E},size:{width:y,height:O}})}}))}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],a=e.id,r=e.nodeInstanceId,i=e.positionX,c=e.positionY,l=e.inPorts,s=e.outPorts,u=e.entity;Object(J["a"])(l,"sequence").forEach((function(e){n.push(Object(o["a"])(Object(o["a"])({},e),{},{group:e.portGroup,id:e.id.toString(),connected:!!t[e.id.toString()]}))})),Object(J["a"])(s,"sequence").forEach((function(e){n.push(Object(o["a"])(Object(o["a"])({},e),{},{group:e.portGroup,id:e.id.toString(),connected:!!t[e.id.toString()]}))}));var d=i||0,p=c||0;return Object(o["a"])(Object(o["a"])({},e),{},{x:d,y:p,type:"node",id:(r||a).toString(),width:R["f"],height:R["d"],data:Object(o["a"])(Object(o["a"])({},e),{},{type:"node",x:d,y:p,id:(r||a).toString()}),ports:{items:n},zIndex:10,entity:u})}function ee(e,t){var n,a,r,o,i=e.isCollapsed,c=void 0!==i&&i,l=null===(n=Object(Q["a"])(t,"x"))||void 0===n?void 0:n.x,s=null===(a=Object(Q["a"])(t,"y"))||void 0===a?void 0:a.y,u=null===(r=Object(X["a"])(t,"x"))||void 0===r?void 0:r.x,d=null===(o=Object(X["a"])(t,"y"))||void 0===o?void 0:o.y,p=l-R["b"],f=s-R["c"],m=u-l+2*R["b"]+R["f"];return c?{x:p+m/2-R["f"]/2,y:f,width:R["f"],height:R["d"]}:{x:p,y:f,width:m,height:d-s+2*R["c"]+R["d"]}}function te(e,t,n){var a=e.id,r=e.isCollapsed,i=void 0!==r&&r,c=t.filter((function(e){return e.groupId.toString()===a.toString()})),l=ee(e,c),s=l.x,u=l.y,d=l.width,p=l.height;if(i&&n){c.forEach((function(e){e.data.hide=!0}));var f=c.map((function(e){return e.id.toString()})),m=n.filter((function(e){var t=e.source,n=e.target;return f.includes(n.cell.toString())&&!f.includes(t.cell.toString())})),g=n.filter((function(e){var t=e.source,n=e.target;return f.includes(t.cell.toString())&&!f.includes(n.cell.toString())})),h=[];if(null===m||void 0===m?void 0:m.length){var v=Date.now().toString();h.push({group:"in",id:v,connected:!0}),m.forEach((function(e){var t=e.source,r=e.outputPortId;n.push({sourceAnchor:"bottom",source:{cell:t.cell.toString(),port:r.toString(),anchor:{name:"bottom"}},target:{cell:a.toString(),port:v,anchor:{name:"center"}},label:"",zIndex:1})}))}if(null===g||void 0===g?void 0:g.length){var b=(Date.now()+1).toString();h.push({group:"out",id:b,connected:!1}),g.forEach((function(e){var t=e.target,r=e.inputPortId;n.push({type:"group",sourceAnchor:"bottom",source:{cell:a,port:b,anchor:{name:"bottom"}},target:{cell:t.cell,port:r,anchor:{name:"center"}},label:"",zIndex:1})}))}return Object(o["a"])(Object(o["a"])({type:"group"},e),{},{id:a.toString(),x:s,y:u,width:d,height:p,zIndex:1,data:Object(o["a"])(Object(o["a"])({},e),{},{type:"group",includedNodes:c,id:a.toString()}),ports:{items:h}})}return Object(o["a"])(Object(o["a"])({type:"group"},e),{},{id:a.toString(),x:s,y:u,width:d,height:p,zIndex:1,data:Object(o["a"])(Object(o["a"])({},e),{},{type:"group",includedNodes:c,id:a.toString()})})}function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.nodes,n=void 0===t?[]:t,a=e.links,i=void 0===a?[]:a,c=e.groups,l=void 0===c?[]:c,s=i.map((function(e){var t=e.source,n=e.outputPortId,a=e.target,r=e.inputPortId;return Object(o["a"])(Object(o["a"])({},e),{},{data:Object(o["a"])({},e),sourceAnchor:"bottom",source:{cell:t,port:n,anchor:{name:"bottom"}},target:{cell:a,port:r,anchor:{name:"center"}},label:"",zIndex:1})})),u=s.reduce((function(e,t){return e[t.inputPortId]=!0,e}),{}),d=n.map((function(e){return Z(e,u)})),p=l.map((function(e){return te(e,d,s)}));return{nodes:[].concat(Object(r["a"])(d),Object(r["a"])(p.filter((function(e){var t,n;return!!(null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.includedNodes)||void 0===n?void 0:n.length)})))),edges:s}}F["d"].registerConnector("pai",(function(e,t){var n=4,a=80,r={x:e.x,y:e.y+n+a},o={x:t.x,y:t.y-n-a};return"M ".concat(e.x," ").concat(e.y,"\n       L ").concat(e.x," ").concat(e.y+n,"\n       C ").concat(r.x," ").concat(r.y," ").concat(o.x," ").concat(o.y," ").concat(t.x," ").concat(t.y-n,"\n       L ").concat(t.x," ").concat(t.y,"\n      ")}),!0);var ae=n("D0BC"),re=n.n(ae),oe=function(e){var t=e.name,n=e.x,a=e.y,r=e.entity,o="".concat(Date.now());return{id:o,name:t,inPorts:[{sequence:1,id:o+"_in_1",portGroup:"in",description:"\u8fde\u63a5\u5165\u53e3"},{sequence:1,id:o+"_leftin_1",portGroup:"leftin",description:"\u8fde\u63a5\u5165\u53e3"}],outPorts:[{sequence:1,id:o+"_out_1",portGroup:"out",description:"\u8fde\u63a5\u51fa\u53e3"},{sequence:1,id:o+"_rightout_1",portGroup:"rightout",description:"\u8fde\u63a5\u51fa\u53e3"}],positionX:n+200+re()(20,!1),positionY:a+re()(10,!1),entity:r}},ie=function(e){var t=e.name,n=e.x,a=e.y,r=e.entity,o=e.intl,i=r.entityId;return{id:i,name:t,inPorts:[{sequence:1,id:i+"_in_1",portGroup:"in",description:o?o.formatMessage({id:"control.connector.in"}):"connector in"},{sequence:1,id:i+"_leftin_1",portGroup:"leftin",description:o?o.formatMessage({id:"control.connector.in"}):"connector in"}],outPorts:[{sequence:1,id:i+"_out_1",portGroup:"out",description:o?o.formatMessage({id:"control.connector.out"}):"connector out"},{sequence:1,id:i+"_rightout_1",portGroup:"rightout",description:o?o.formatMessage({id:"control.connector.out"}):"connector out"}],positionX:n,positionY:a,entity:r}},ce=(n("Xrv+"),n("okkz")),le=n("U+PY"),se=n("xGfz"),ue=n("gUdW"),de=n("itvd"),pe=function(e){var t,n,a=e.dataSourceId,r=e.nodeId,o=(e.entity,ve(a)),i=Object(E["useState"])(!1),c=Object(T["a"])(i,2),l=c[0],s=c[1],u=function(){o.toggleNode(!l,r),s(!l)},d=Object(de["a"])((function(){return o.ERGraph$.pipe(Object(k["a"])((function(e){return!!e})),Object(B["a"])((function(e){return e.nodes})))}),{}),p=Object(T["a"])(d,1),f=p[0];if(!f.length||0===f.length)return null;var m=null===f||void 0===f?void 0:f.find((function(e){return e.id===r})),g=!0===(null===m||void 0===m||null===(t=m.entity)||void 0===t?void 0:t.isMain),h=null===(n=f.find((function(e){return e.id.toString()===r})))||void 0===n?void 0:n.entity;if(!h)return null;var v=function(){var e="";return!0===g&&(e=" primaryentity"),"1"===h.queryTopN&&(e+=" topnentity"),h.entityType===ce["a"].ExcelSheet?"excelsheet"+e:h.entityType===ce["a"].ODataEntity?"odataentity"+e:"dbtable"+e};return y.a.createElement("div",{className:"entity-container ".concat(v())},y.a.createElement("div",{className:"content ".concat(v())},y.a.createElement("div",{className:"head"},y.a.createElement("div",null,y.a.createElement(le["a"],{className:"type"}),y.a.createElement("span",null,null===h||void 0===h?void 0:h.name)),l?y.a.createElement(se["a"],{className:"more",onClick:u}):y.a.createElement(ue["a"],{className:"more",onClick:u})),y.a.createElement("div",{className:"body"},h.properties.map((function(e){return e.hidden?null:y.a.createElement("div",{className:"body-item",key:e.propertyId},y.a.createElement("div",{className:"name"},((null===e||void 0===e?void 0:e.isPK)||(null===e||void 0===e?void 0:e.isFK))&&y.a.createElement("span",{className:"pk"},"K"),e.name),y.a.createElement("div",{className:"type"},e.propertyType))})))))},fe=n("7Cbv"),me=n("2WP7"),ge=function(e){Object(g["a"])(n,e);var t=Object(h["a"])(n);function n(e){var a,r;return Object(p["a"])(this,n),r=t.call(this,{history:!0,frozen:!0,selecting:{enabled:!0,rubberband:!1,multiple:!0,strict:!0,showNodeSelectionBox:!1,selectNodeOnMoved:!1},keyboard:{enabled:!0},connecting:{snap:{radius:10},allowBlank:!1,highlight:!0,sourceAnchor:"bottom",targetAnchor:"center",connectionPoint:"anchor",createEdge:function(){return new Y({id:Object(fe["a"])()})},validateEdge:function(e){var t,n=e.edge;return!!(null===n||void 0===n||null===(t=n.target)||void 0===t?void 0:t.port)},validateMagnet:function(e){var t=e.magnet;return"in"!==t.getAttribute("port-group")&&"leftin"!==t.getAttribute("port-group")},validateConnection:function(e){var t=e.sourceView,n=e.targetView,a=e.sourceMagnet,r=e.targetMagnet;return t!==n&&(!(!a||"in"===a.getAttribute("port-group")||"leftin"===a.getAttribute("port-group"))&&!(!r||"in"!==r.getAttribute("port-group")&&"leftin"!==r.getAttribute("port-group")))}},scroller:{enabled:!0,pageVisible:!1,pageBreak:!1,pannable:!0},highlighting:{nodeAvailable:{name:"className",args:{className:"available"}},magnetAvailable:{name:"className",args:{className:"available"}},magnetAdsorbed:{name:"className",args:{className:"adsorbed"}}},onPortRendered:function(e){var t=e.port,n=e.contentSelectors,a=n&&n.content,r="in"===t.group?"top":"leftin"===t.group?"left":"out"===t.group?"bottom":"right";a&&_.a.render(y.a.createElement(u["b"],{prefixCls:x},y.a.createElement(d["a"],{title:t.description,placement:r},y.a.createElement("span",{className:S()("ais-port",{connected:t.connected})}))),a)},onEdgeLabelRendered:function(e){var t=e.selectors,n=(e.edge,t.foContent);n&&(n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",_.a.render(y.a.createElement(s["a"],{size:"small",type:"dashed"},y.a.createElement(D["a"],null)),n))}}),r.nodeMetas=void 0,r.edgeMetas=void 0,r.pendingNodes=[],r.dataSource=void 0,r.loading$=new w["a"](!1),r.checking$=new w["a"](!1),r.ERGraph$=new w["a"](null),r.activeNodeInstance$=new w["a"](null),r.mainEntityId$=new w["a"](""),r.activeModal$=new w["a"](null),r.ERGraphSub=void 0,r.executionStatusQuerySub=void 0,r.reRenderSub=void 0,r.renderGraph=function(e,t){r.ERGraphSub=r.ERGraph$.pipe(Object(k["a"])((function(e){return!!e})),Object(M["a"])(1)).subscribe((function(o){if(!r.graph){var i=ne(o),c=i.nodes,l=i.edges;Object(v["a"])((a=Object(m["a"])(r),Object(b["a"])(n.prototype)),"render",a).call(a,{wrapper:e,container:t,nodes:c,edges:l})}})),r.reRenderSub=Object(N["a"])((function(e){window.addEventListener(R["g"],e)}),(function(e){window.removeEventListener(R["g"],e)})).subscribe(r.handlerResize)},r.validateContextMenu=function(e){var t,n;return!("edge"===e.type&&(null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.edge)||void 0===n?void 0:n.isGroupEdge()))},r.handlerResize=function(e){e.detail===r.dataSource.dataSourceId&&r.resizeGraph()},r.checkEdgeStatus=function(){if(r.graph){var e=Object(m["a"])(r),t=e.graph,n=r.ERGraph$.getValue(),a=n.links,o=a.filter((function(e){var t;return!e.mappingProperties||0===(null===(t=e.mappingProperties)||void 0===t?void 0:t.length)})).map((function(e){return e.id}));r.updateEdges((function(e){var n=!1;e.forEach((function(e){var a=e,r=a.id,i=null===t||void 0===t?void 0:t.findViewByCell(r);i&&(o.includes(r.toString())?(i.removeClass("edgeSuccess"),i.addClass("edgeError"),n=!0):(i.removeClass("edgeError"),i.addClass("edgeSuccess")))})),n||r.checking$.next(!1)}))}},r.checkDatasourceConfig=Object(l["a"])(c.a.mark((function e(){return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,r.checking$.next(!0),r.clearContextMenuInfo(),r.checkEdgeStatus(),e.abrupt("return",{success:!0});case 7:return e.prev=7,e.t0=e["catch"](0),console.error("\u6267\u884c\u5931\u8d25",e.t0),e.abrupt("return",{success:!1});case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),r.saveDataConfigSetting=function(){var e=Object(l["a"])(c.a.mark((function e(t,n){var a,o,i,l,s;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,o=r.ERGraph$.getValue(),i=r.ERGraph$.getValue().nodes.find((function(e){return!0===e.entity.isMain})),e.next=5,me["a"].getInstance().convertSchema(o.nodes,o.links,n);case 5:return l=e.sent,e.next=8,me["a"].getInstance().getCustomDataSample(l,null===i||void 0===i||null===(a=i.entity)||void 0===a?void 0:a.queryTopN,n);case 8:return s=e.sent,r.clearContextMenuInfo(),e.abrupt("return",{success:!(!l||!s),customData:s,schema:l});case 13:return e.prev=13,e.t0=e["catch"](0),console.error("\u4fdd\u5b58\u5931\u8d25",e.t0),e.abrupt("return",{success:!1});case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),r.setActiveAlgoData=function(e){if(e){var t=r.activeNodeInstance$.getValue();r.activeNodeInstance$.next(Object(o["a"])(Object(o["a"])({},t),e))}else r.activeNodeInstance$.next(null)},r.requestAddNode=function(){var e=Object(l["a"])(c.a.mark((function e(t){var n,a,i,l,s,u,d,p,f;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Object(m["a"])(r),a=n.graph,!a){e.next=11;break}return i=t.nodeMeta,l=t.clientX,s=t.clientY,u=t.intl,d=a.clientToLocal(l,s),e.next=6,ie(Object(o["a"])(Object(o["a"])(Object(o["a"])({},i),d),{},{intl:u}));case 6:return p=e.sent,r.updateERGraph([p]),f=Z(p),r.addNode(f),e.abrupt("return",{success:!0});case 11:return e.abrupt("return",{success:!1});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.requestSetMainNode=function(){var e=Object(l["a"])(c.a.mark((function e(t){var n;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=r.mainEntityId$.getValue(),!(n&&n.length>0)){e.next=4;break}return e.next=4,r.setMainEntity(n,!1);case 4:return e.next=6,r.setMainEntity(t,!0);case 6:return r.mainEntityId$.next(t),r.clearContextMenuInfo(),e.abrupt("return",{success:!0});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.requestDeleteNodes=function(){var e=Object(l["a"])(c.a.mark((function e(t){var n,a;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=[].concat(t),!r.graph||!n.length){e.next=8;break}return r.deleteNodes(n),r.clearContextMenuInfo(),a=r.activeNodeInstance$.getValue(),a&&n.map((function(e){return e.toString()})).includes(a.id.toString())&&r.activeNodeInstance$.next(null),r.delERGraphElement(n,[]),e.abrupt("return",{success:!0});case 8:return e.abrupt("return",{success:!1});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.requestDeleteEdges=function(){var e=Object(l["a"])(c.a.mark((function e(t){var n;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=[].concat(t),console.log(n),r.deleteEdges(n),e.next=5,r.delERGraphElement([],n.map((function(e){return e.getData()})));case 5:return n.forEach(function(){var e=Object(l["a"])(c.a.mark((function e(t){var n;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.getData(),e.next=3,r.updateEdgeNodePKFKs(n.source,n.target);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",{success:!0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.undoDeleteNode=Object(l["a"])(c.a.mark((function e(){return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r.undo();case 1:case"end":return e.stop()}}),e)}))),r.setMainEntity=function(){var e=Object(l["a"])(c.a.mark((function e(t,n){var a,i,l,s,u;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={success:!0},a.success&&(i=r.getCellById(t),l=i.getData(),s=Object(C["cloneDeep"])(l.entity),s.isMain=n,u=Object(o["a"])(Object(o["a"])({},Object(C["cloneDeep"])(l)),{},{entity:s}),i.setData(u),r.updateERGraph([u])),e.abrupt("return",a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.updateERNodeSettingAndProperties=function(){var e=Object(l["a"])(c.a.mark((function e(t,n,a,o){var i;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new Promise((function(e){var i=r.getCellById(t),c=i.getData(),l=Object(C["cloneDeep"])(c);l.entity.properties=n,l.entity.queryTopN=a,l.entity.filters=o,i.updateData(l),r.updateERGraph([l]),e(!0)})),e.next=3,i;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),r.updateEREdgeProperties=function(){var e=Object(l["a"])(c.a.mark((function e(t,n,a,o){var i;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new Promise((function(e){var n=r.getCellById(t),a=n.getData(),i=Object(C["cloneDeep"])(a);i.mappingProperties=o,n.updateData(i),r.updateERGraph([],[i]),e(!0)})),e.next=3,i;case 3:return e.next=5,r.updateEdgeNodePKFKs(n,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a,r){return e.apply(this,arguments)}}(),r.updateNodePKFKs=function(){var e=Object(l["a"])(c.a.mark((function e(t,n,a){var o;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=new Promise((function(e){var o=r.getCellById(t),i=o.getData(),c=Object(C["cloneDeep"])(i);c.entity.properties.forEach((function(e){e.isPK=!1,e.isFK=!1})),n.forEach((function(e){var t;null===(t=e.mappingProperties)||void 0===t||t.forEach((function(e){c.entity.properties.forEach((function(t){a?t.propertyId===e.sourcePropertyId&&(t.isFK=!0):t.propertyId===e.targetPropertyId&&(t.isPK=!0)}))}))})),o.setData(c),r.updateERGraph([c]),e(!0)})),e.next=3,o;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),r.updateEdgeNodePKFKs=function(){var e=Object(l["a"])(c.a.mark((function e(t,n){var a,o,i;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=r.ERGraph$.getValue().links,o=a.filter((function(e){return e.source===t})),i=a.filter((function(e){return e.target===n})),e.next=5,r.updateNodePKFKs(t,o,!0);case 5:if(e.t0=e.sent,!e.t0){e.next=10;break}return e.next=9,r.updateNodePKFKs(n,i,!1);case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.toggleNode=function(e,t){var n=e?R["e"]:R["d"];r.changeNodeHeight(t,n)},r.zoomGraph=function(e){r.zoom(e)},r.zoomGraphToFit=function(){r.zoom("fit")},r.zoomGraphRealSize=function(){r.zoom("real")},r.deleteEdgeFromContextMenu=function(){var e=Object(l["a"])(c.a.mark((function e(t){return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.requestDeleteEdges(t);case 2:r.clearContextMenuInfo();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.unSelectNode=function(){var e=Object(m["a"])(r),t=e.graph;t&&t.cleanSelection(),r.selectedNodes$.next([])},r.dataSource=e,r.initialize(),r}return Object(f["a"])(n,[{key:"initialize",value:function(){var e=Object(l["a"])(c.a.mark((function e(){var t;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.dataSource,this.loading$.next(!0),e.prev=2,e.next=5,this.loadERGraph(t);case 5:this.loading$.next(!1),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](2),this.loading$.next(!1),console.error("\u52a0\u8f7d\u5b9e\u9a8c\u9519\u8bef",e.t0);case 12:case"end":return e.stop()}}),e,this,[[2,8]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"changeDataSource",value:function(){var e=Object(l["a"])(c.a.mark((function e(t){return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.dataSource=t,e.next=3,this.initialize();case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"loadStoredGraph",value:function(e){return e&&e.erMappingContent&&e.erMappingContent.nodes&&e.erMappingContent.nodes.length>0?{success:!0,data:e.erMappingContent,Lang:"zh_CN",lang:"zh_CN"}:{lang:"zh_CN",success:!0,data:{nodes:[],links:[]},Lang:"zh_CN"}}},{key:"loadERGraph",value:function(){var e=Object(l["a"])(c.a.mark((function e(t){var n,a=this;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new Promise((function(e){var n=a.loadStoredGraph(t);a.ERGraph$.next(n.data),e(!0)})),e.next=3,n;case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updateERGraph",value:function(){var e=Object(l["a"])(c.a.mark((function e(){var t,n,a,o,i=arguments;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=i.length>0&&void 0!==i[0]?i[0]:[],n=i.length>1&&void 0!==i[1]?i[1]:[],a=this.ERGraph$.getValue(),o=Object(I["a"])(a,(function(e){for(var a=function(n){var a=t[n],r=e.nodes.find((function(e){return e.id.toString()===a.id.toString()}));r?Object.assign(r,Object(C["cloneDeep"])(a)):e.nodes.push(Object(C["cloneDeep"])(a))},o=0;t.length>0&&o<t.length;o++)a(o);for(var i=function(t){var a,o=n[t],i=e.links.find((function(e){return e.id===o.id}));i?Object.assign(i,Object(C["cloneDeep"])(o)):(a=e.links).push.apply(a,Object(r["a"])(n))},c=0;n.length>0&&c<n.length;c++)i(c)})),this.ERGraph$.next(o);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"delERGraphElement",value:function(){var e=Object(l["a"])(c.a.mark((function e(){var t,n,a,r,o=arguments;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:[],n=o.length>1&&void 0!==o[1]?o[1]:[],a=this.ERGraph$.getValue(),r=Object(I["a"])(a,(function(e){t.length?e.nodes=a.nodes.filter((function(e){return!t.includes(e.id.toString())})):e.links=a.links.filter((function(e){return!n.find((function(t){return t.id.toString()===e.id.toString()}))}))})),this.ERGraph$.next(r);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"copyGraphtoClipboard",value:function(){var e=this.ERGraph$.getValue(),t=JSON.stringify(e);console.log(t)}},{key:"isGraphReady",value:function(){return!!this.graph}},{key:"renderNode",value:function(e){var t=this.dataSource,n=t.dataSourceId,a=e.data,r=a,i=r.type,c=r.entity;if("node"===i){var l=this.graph.addNode(new U(Object(o["a"])(Object(o["a"])({},e),{},{shape:"ais-rect-port",component:y.a.createElement(pe,{key:c,dataSourceId:n,nodeId:e.id.toString(),entity:c})})));return e.data.hide&&this.pendingNodes.push(l),l}}},{key:"afterLayout",value:function(){Object(v["a"])(Object(b["a"])(n.prototype),"afterLayout",this).call(this),this.pendingNodes.forEach((function(e){e.hide()})),this.pendingNodes=[]}},{key:"renderEdge",value:function(e){return this.graph.addEdge(new Y(e))}},{key:"onSelectNodes",value:function(e){var t=e.filter((function(e){return e.isNode()})),n=e.filter((function(e){return e.isEdge()}));if(1!==t.length)if(1!==n.length)this.selectedNodes$.next(t),this.activeNodeInstance$.next(null);else{var a=n[0],r=a.getData(),o=this.activeNodeInstance$.getValue();(null===o||void 0===o?void 0:o.inputPortId)!==(null===r||void 0===r?void 0:r.inputPortId)&&(null===o||void 0===o?void 0:o.outputPortId)!==(null===r||void 0===r?void 0:r.outputPortId)&&this.activeNodeInstance$.next(r)}else{var i=t[0],c=i.getData(),l=this.activeNodeInstance$.getValue();(null===l||void 0===l?void 0:l.id)!==(null===c||void 0===c?void 0:c.id)&&this.activeNodeInstance$.next(c)}}},{key:"onConnectNode",value:function(){var e=Object(l["a"])(c.a.mark((function e(t){var n,a,r,o,i,l,s,u,d;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.edge,a=void 0===n?{}:n,r=t.isNew,o=a,i=o.source,l=o.target,r&&(s=t.currentCell,u=a.getTargetPortId(),s&&u&&(s.setPortProp(u,"connected",!0),a.attr({line:{stroke:"#808080"}}),d={id:a.id,source:i.cell,target:l.cell,outputPortId:i.port,inputPortId:l.port},a.setData(d),this.updateERGraph([],[d]),this.addEdge(a))),e.abrupt("return",{success:!0});case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onConnectionRemoved",value:function(e){try{var t=e.edge,n=t.target,a=n,r=a.cell,o=a.port;if(r){var i=this.getNodeById(r);i&&i.setPortProp(o,"connected",!1)}}catch(c){console.warn(c)}}},{key:"onMoveNodeStart",value:function(e){var t=e.node,n=t.getParent(),a=null===n||void 0===n?void 0:n.getData();a&&!(null===a||void 0===a?void 0:a.isCollapsed)&&H({moveNodes:[t]})}},{key:"onMoveNodes",value:function(){var e=Object(l["a"])(c.a.mark((function e(t){var n,a,r,o,i=this;return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=t.filter((function(e){var t=e.node;return!t.isGroup()})),(null===n||void 0===n?void 0:n.length)&&(a=n.map((function(e){var t=e.current,n=e.node,a=t.x,r=t.y,o=n.id;return i.updateNodeById(o,(function(e){e.setData({x:a,y:r})})),{nodeInstanceId:o,posX:Object(C["round"])(a),posY:Object(C["round"])(r)}})),r=this.ERGraph$.getValue(),o=Object(I["a"])(r,(function(e){a.forEach((function(t){var n=t.nodeInstanceId,a=t.posX,r=t.posY,o=e.nodes.find((function(e){return e.id.toString()===n.toString()}));o&&(o.positionX=a,o.positionY=r)}))})),this.ERGraph$.next(o));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"onDeleteNodeOrEdge",value:function(e){var t=e.nodes,n=e.edges,a=t.filter((function(e){return!e.isGroup()}));(null===a||void 0===a?void 0:a.length)&&this.requestDeleteNodes(a.map((function(e){return e.id}))),(null===n||void 0===n?void 0:n.length)&&this.requestDeleteEdges(n)}},{key:"validateNodeCopyable",value:function(e){return(null===e||void 0===e?void 0:e.isNode())&&!e.isGroup()}},{key:"onCopyNode",value:function(e){try{var t=e.getData(),n=oe(t),r=Z(n);this.addNode(r),this.clearContextMenuInfo()}catch(o){a["default"].error("\u590d\u5236\u8282\u70b9\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}}},{key:"setModal",value:function(){var e=Object(l["a"])(c.a.mark((function e(t){return c.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.activeModal$.next(t);case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"dispose",value:function(){var e,t,a;null===(e=this.ERGraphSub)||void 0===e||e.unsubscribe(),null===(t=this.executionStatusQuerySub)||void 0===t||t.unsubscribe(),null===(a=this.reRenderSub)||void 0===a||a.unsubscribe(),Object(v["a"])(Object(b["a"])(n.prototype),"dispose",this).call(this)}}]),n}(V),he=new Map,ve=function(e){var t=he.get(e);return t},be=function(e){var t=he.get(e.dataSourceId);return t||(he.set(e.dataSourceId,new ge(e)),t=he.get(e.dataSourceId)),t},Ee=function(e){Object(E["useEffect"])((function(){return function(){var t=he.get(e);t&&(t.dispose(),he.delete(e))}}),[e])}},OanE:function(e,t,n){e.exports={bottomToolbar:"bottomToolbar___3AGj0",itemList:"itemList___2W5Pj",item:"item___2IpCX",disabled:"disabled___36B0Z",menu:"menu___3DG7s",label:"label___cp-6O",icon:"icon___3EkZA",menuPopover:"menuPopover___30UUj",popover:"popover___6guu4"}},PADK:function(e,t,n){e.exports={handler:"handler___2e81C",item:"item___3RaKQ",popover:"popover___11Uk4"}},Qf5C:function(e,t,n){e.exports={searchList:"searchList___3DBPQ",resultTips:"resultTips___1u7ne",icon:"icon___IyPDq"}},WEsZ:function(e,t,n){},XktK:function(e,t,n){},"Xrv+":function(e,t,n){},YXs9:function(e,t,n){e.exports={settingscontainer:"settingscontainer___3lyyB",settingcard:"settingcard___2SB3C",tablemappinglink:"tablemappinglink___2qjix",dbnamefield:"dbnamefield___2ijeJ",dbportfield:"dbportfield___2pFxY",dbusernamefield:"dbusernamefield___3Gnm3",dbpwdfield:"dbpwdfield___3A1eR",otherparmsfield:"otherparmsfield___5y4Eg",btnermapping:"btnermapping___1-9YA"}},YY5l:function(e,t,n){e.exports={componentSourceTree:"componentSourceTree___3fLVf",component:"component___YG78l",links:"links___uJk43",link:"link___LqN-6"}},YiEN:function(e,t,n){e.exports={setting:"setting___3KezZ",form:"form___izV4k",mappingfield:"mappingfield___26WDU",topngroup:"topngroup___3bnVA",nodepropertylist:"nodepropertylist___1cZoA",edgepropertylist:"edgepropertylist___1II47",footer:"footer___1w1BV"}},ZGoK:function(e,t,n){e.exports={menuWrap:"menuWrap___1QCYm",name:"name___3TfiB",wrap:"wrap___2bB3e",divider:"divider___PMEyt",dropdown:"dropdown___1ErR3"}},ajgr:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"f",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return c})),n.d(t,"g",(function(){return l})),n.d(t,"a",(function(){return s}));var a=24,r=40,o=214,i=200,c=40,l="RERENDER_EVENT",s="ENTITY_COMPONENT"},bsjA:function(e,t,n){e.exports={searchInput:"searchInput___3O0qP",input:"input___3RPGU"}},fEHO:function(e,t,n){e.exports={header:"header___1C3b0",headerLeft:"headerLeft___2-Be-",headerRight:"headerRight___3EFZp",doc:"doc___3beXh",text:"text___1wQCx"}},itvd:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n("ODXe"),r=n("q1tI"),o=n("26FU"),i=function(e,t){var n=Object(r["useMemo"])((function(){return"function"===typeof e?e():e}),[e]),i=Object(r["useState"])((function(){return n instanceof o["a"]?n.getValue():t})),c=Object(a["a"])(i,2),l=c[0],s=c[1];return Object(r["useEffect"])((function(){var e=n.subscribe((function(e){s(e)}));return function(){e.unsubscribe()}}),[n]),[l,s]}},kcI3:function(e,t,n){e.exports={graphContextMenu:"graphContextMenu___2EVTG",loadDataSourceModal:"loadDataSourceModal___28ufQ",versionTable:"versionTable___19qaL",operations:"operations___1jQTc"}},"ozZ+":function(e,t,n){e.exports={flex:"flex___3Pgdn",layout:"layout___3w0cS",content:"content___1vFTa",datasource:"datasource___1Ae2T",nodeSourceTree:"nodeSourceTree___3t8PE",editPanel:"editPanel___3zIIj",dagCanvas:"dagCanvas___2Fau5",confPanel:"confPanel___1i4oS"}},qr3z:function(e,t,n){e.exports={mask:"mask___1UW0E"}},rCxb:function(e,t,n){"use strict";n.r(t),n.d(t,"ComponentConfigPanel",(function(){return W}));n("Znn+");var a=n("ZTPi"),r=n("ODXe"),o=n("q1tI"),i=n.n(o),c=n("TSYQ"),l=n.n(c),s=n("itvd"),u=n("MgPD"),d=(n("IzEo"),n("bx4M")),p=(n("/zsF"),n("PArb")),f=(n("tU7J"),n("wFql")),m=n("26re"),g=n("9kvl"),h=f["a"].Paragraph,v=f["a"].Title,b=Object(g["b"])((function(e){var t=e.name,n=(e.dataSourceId,e.intl),a=Object(g["e"])("entity-metadata-loader"),r=a.dataSource;return i.a.createElement(d["a"],{title:i.a.createElement("div",null,i.a.createElement(m["a"],null),i.a.createElement("span",null," ",t))},i.a.createElement(v,{level:5},n.formatMessage({id:"control.ds.config.id"})),i.a.createElement(h,{copyable:{tooltips:[n.formatMessage({id:"control.ds.tooltip.copy"}),n.formatMessage({id:"message.ds.tooltip.copy.success"})]}},r.dataSourceId),i.a.createElement(p["a"],null),i.a.createElement(v,{level:5},n.formatMessage({id:"control.ds.config.name"})),i.a.createElement(h,{copyable:{tooltips:[n.formatMessage({id:"control.ds.tooltip.copy"}),n.formatMessage({id:"message.ds.tooltip.copy.success"})]}},r.dataSourceName),i.a.createElement(p["a"],null),i.a.createElement(v,{level:5},n.formatMessage({id:"control.ds.config.link"})),i.a.createElement(h,{copyable:{tooltips:[n.formatMessage({id:"control.ds.tooltip.copy"}),n.formatMessage({id:"message.ds.tooltip.copy.success"})]}},r.dataUri))})),E=(n("y8nQ"),n("Vl3Y")),y=(n("14J3"),n("BMrR")),O=(n("jCWc"),n("kPKH")),_=(n("+L6B"),n("2/Rp")),x=n("o0o1"),j=n.n(x),S=(n("miYZ"),n("tsqr")),w=n("HaE+"),N=(n("sRBo"),n("kaz8")),k=n("XIp8"),M=n("VnD/"),C=n("67Y/"),I=n("U+PY"),D=n("bRQS"),R=(n("7Kak"),n("9yH6")),T=(n("5NDa"),n("5rEg")),P=n("wx14"),F=(n("OaEy"),n("2fM7")),A=n("wlus"),G=n("xvlK"),L=F["a"].Option,z=Object(g["b"])((function(e){var t=e.entity,n=e.intl,a=e.isMain,r=e.setTopN,o=null===t||void 0===t?void 0:t.queryTopN,c=[{text:n.formatMessage({id:"control.node.config.expr.equal"}),value:"equal"},{text:n.formatMessage({id:"control.node.config.expr.greatthan"}),value:"greatthan"},{text:n.formatMessage({id:"control.node.config.expr.lessthan"}),value:"lessthan"},{text:n.formatMessage({id:"control.node.config.expr.noequal"}),value:"noequal"},{text:n.formatMessage({id:"control.node.config.expr.notgreatthan"}),value:"notgreatthan"},{text:n.formatMessage({id:"control.node.config.expr.notlessthan"}),value:"notlessthan"},{text:n.formatMessage({id:"control.node.config.expr.contains"}),value:"contains"}],l=function(e){r(e.target.value)},s=function(e){console.log("selected ".concat(e))},u=function(){console.log("blur")},d=function(){console.log("focus")},p=function(e){console.log("search:",e)};return!0===a?i.a.createElement("div",{className:"topngroup"},i.a.createElement(E["a"].List,{name:"filtermappings"},(function(e,a){var r=a.add,o=a.remove;return i.a.createElement(i.a.Fragment,null,e.map((function(e){var a;return i.a.createElement(y["a"],{key:e.key,justify:"space-between",align:"middle"},i.a.createElement(O["a"],{span:8},i.a.createElement(E["a"].Item,Object(P["a"])({},e,{name:[e.name,"operator"],fieldKey:[e.fieldKey,"operator"],initialValue:"equal",rules:[{required:!0,message:n.formatMessage({id:"message.node.config.required.operator"})}]}),i.a.createElement(F["a"],{style:{width:90},optionFilterProp:"children",filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},c.map((function(e,t){return i.a.createElement(L,{key:t,value:e.value},e.text)}))))),i.a.createElement(O["a"],null,i.a.createElement(y["a"],null,i.a.createElement(O["a"],null,i.a.createElement(E["a"].Item,Object(P["a"])({},e,{name:[e.name,"propertyId"],fieldKey:[e.fieldKey,"propertyId"],rules:[{required:!0,message:n.formatMessage({id:"message.node.config.required.propertyid"})}]}),i.a.createElement(F["a"],{showSearch:!0,style:{width:130},placeholder:null===t||void 0===t?void 0:t.name,optionFilterProp:"children",onChange:s,onFocus:d,onBlur:u,onSearch:p,filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},null===t||void 0===t||null===(a=t.properties)||void 0===a?void 0:a.map((function(e){return i.a.createElement(L,{key:e.propertyId,value:e.propertyId},e.name)})))))),i.a.createElement(y["a"],null,i.a.createElement(O["a"],null,i.a.createElement(E["a"].Item,Object(P["a"])({},e,{name:[e.name,"valueAsString"],fieldKey:[e.fieldKey,"valueAsString"],rules:[{required:!1}]}),i.a.createElement(T["a"],{style:{width:130}}))))),i.a.createElement(O["a"],{span:2},i.a.createElement(A["a"],{onClick:function(){return o(e.name)}})))})),i.a.createElement(E["a"].Item,null,i.a.createElement(_["a"],{type:"dashed",onClick:function(){return r()},block:!0,icon:i.a.createElement(G["a"],null)},n.formatMessage({id:"control.node.config.btn.add"}))))}))):i.a.createElement("div",{className:"topngroup"},i.a.createElement(E["a"].Item,null,i.a.createElement(R["a"].Group,{onChange:l,defaultValue:o},i.a.createElement(R["a"],{value:"1"},n.formatMessage({id:"message.node.record.pickone"})),i.a.createElement(R["a"],{value:"N"},n.formatMessage({id:"message.node.record.takeall"})))))})),B=(n("XktK"),Object(g["b"])((function(e){var t,n,a,o,c=e.nodeId,l=e.dataSourceId,f=e.entity,m=e.intl,g=Object(u["b"])(l),h=Object(s["a"])((function(){return g.ERGraph$.pipe(Object(M["a"])((function(e){return!!e})),Object(C["a"])((function(e){return e.nodes})))}),[]),v=Object(r["a"])(h,1),b=v[0],x=null===b||void 0===b?void 0:b.find((function(e){return e.id===c})),R=!0===(null===x||void 0===x||null===(t=x.entity)||void 0===t?void 0:t.isMain),T=null===f||void 0===f||null===(n=f.properties)||void 0===n?void 0:n.filter((function(e){return!e.hidden})).map((function(e){return e.name})),P=null===f||void 0===f||null===(a=f.properties)||void 0===a?void 0:a.map((function(e){return e.name})),F=i.a.useState(T),A=Object(r["a"])(F,2),G=A[0],L=A[1],B=i.a.useState(!1),q=Object(r["a"])(B,2),V=q[0],K=q[1],$=i.a.useState(!0),U=Object(r["a"])($,2),W=U[0],Y=U[1],Q=i.a.useState(!0===(null===f||void 0===f?void 0:f.isMain)?"10":"N"),X=Object(r["a"])(Q,2),J=X[0],H=X[1],Z=N["a"].Group,ee=function(){var e=Object(w["a"])(j.a.mark((function e(t){var n,a;return j.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(G&&G.length>0)){e.next=7;break}return n=Object(k["a"])(null===f||void 0===f?void 0:f.properties),n.forEach((function(e){return e.hidden=!G.includes(e.name)})),e.next=5,g.updateERNodeSettingAndProperties(c,n,J,t);case 5:a=e.sent,a?S["default"].success(m.formatMessage({id:"message.node.setting.success"}),2):S["default"].error(m.formatMessage({id:"message.node.setting.failed"}),2);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(e){L(e),K(!!e.length&&!!P&&e.length<(null===P||void 0===P?void 0:P.length)),Y(e.length===(null===P||void 0===P?void 0:P.length))},ne=function(e){L(e.target.checked?P:[]),K(!1),Y(e.target.checked)},ae=function(e){var t,n=[];null===e||void 0===e||null===(t=e.filtermappings)||void 0===t||t.forEach((function(e){var t={propertyId:e.propertyId,operator:e.operator,valueAsString:e.valueAsString};n.push(t)})),ee(n)},re={filtermappings:null===f||void 0===f||null===(o=f.filters)||void 0===o?void 0:o.map((function(e){return{propertyId:e.propertyId,operator:e.operator,valueAsString:e.valueAsString}}))};return i.a.createElement(E["a"],{name:"dynamic_form_fields",autoComplete:"off",initialValues:re,onFinish:ae},i.a.createElement(d["a"],{title:i.a.createElement("div",null,i.a.createElement(I["a"],null),i.a.createElement("span",null," ",null===f||void 0===f?void 0:f.name)),actions:[i.a.createElement(_["a"],{key:"checkall",type:"dashed"},i.a.createElement(N["a"],{key:"checkall",indeterminate:V,onChange:ne,checked:W})),i.a.createElement(_["a"],{key:"save",type:"dashed",htmlType:"submit"},i.a.createElement(D["a"],null),m.formatMessage({id:"control.node.config.btn.apply"}))],className:"nodeconfigform"},i.a.createElement(z,{entity:f,intl:m,setTopN:H,isMain:R}),i.a.createElement(p["a"],null),i.a.createElement("div",{className:"nodepropertylist"},i.a.createElement(E["a"].Item,{key:"checkedList",fieldKey:"checkedList"},i.a.createElement(Z,{value:G,onChange:te},null===P||void 0===P?void 0:P.map((function(e){return i.a.createElement(y["a"],{key:e},i.a.createElement(O["a"],null,i.a.createElement(N["a"],{defaultChecked:!0,value:e},e)))})))))))}))),q=n("Uw7j"),V=n("YiEN"),K=n.n(V),$=F["a"].Option,U=Object(g["b"])((function(e){var t=e.nodeId,n=e.dataSourceId,a=e.source,o=e.target,c=e.mappingProperties,l=e.intl,p=Object(u["b"])(n),f=Object(s["a"])((function(){return p.checking$})),m=Object(r["a"])(f,1),g=m[0],h=function(){var e=Object(w["a"])(j.a.mark((function e(n){var r,i;return j.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=[],n.fieldmappings.forEach((function(e){var t={sourcePropertyId:e.source,targetPropertyId:e.target};r.push(t)})),e.next=4,p.updateEREdgeProperties(t,a,o,r.length>0?r:[]);case 4:i=e.sent,i?(S["default"].success(l.formatMessage({id:"message.edge.setting.success"}),2),g&&p.checkDatasourceConfig()):S["default"].error(l.formatMessage({id:"message.edge.setting.failed"}),2);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(e){for(var t=p.ERGraph$.getValue().nodes,n=0;n<t.length;n++){var a=t[n].entity;if(a.entityId===e)return Object(k["a"])(a)}return null},b=v(a),x=v(o),N=null===b||void 0===b?void 0:b.properties.filter((function(e){return!e.hidden})),M=null===x||void 0===x?void 0:x.properties.filter((function(e){return!e.hidden})),C={fieldmappings:null===c||void 0===c?void 0:c.map((function(e){return{source:e.sourcePropertyId,target:e.targetPropertyId}}))},I=function(e){console.log("selected ".concat(e))},R=function(){console.log("blur")},T=function(){console.log("focus")},L=function(e){console.log("search:",e)};return i.a.useEffect((function(){}),[a,o]),i.a.createElement(E["a"],{name:"dynamic_form_fields",autoComplete:"off",initialValues:C,onFinish:h},i.a.createElement(E["a"].List,{name:"fieldmappings"},(function(e,t){var n=t.add,a=t.remove;return i.a.createElement(d["a"],{title:i.a.createElement("div",null,i.a.createElement(q["a"],null),i.a.createElement("span",null," ",l.formatMessage({id:"control.edge.config.title"}))),actions:[i.a.createElement(_["a"],{type:"dashed",htmlType:"submit"},i.a.createElement(D["a"],null)," ",l.formatMessage({id:"control.edge.config.saveconfig"}))]},i.a.createElement("div",{className:K.a.edgepropertylist},e.map((function(e){return i.a.createElement(y["a"],{key:e.key,justify:"space-between",align:"middle",className:K.a.mappingfield},i.a.createElement(O["a"],{span:2},i.a.createElement(q["a"],null)),i.a.createElement(O["a"],null,i.a.createElement(y["a"],null,i.a.createElement(O["a"],null,i.a.createElement(E["a"].Item,Object(P["a"])({},e,{name:[e.name,"source"],fieldKey:[e.fieldKey,"source"],rules:[{required:!0,message:l.formatMessage({id:"message.edge.config.required.master"})}]}),i.a.createElement(F["a"],{showSearch:!0,style:{width:160},placeholder:null===b||void 0===b?void 0:b.name,optionFilterProp:"children",onChange:I,onFocus:T,onBlur:R,onSearch:L,filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},null===N||void 0===N?void 0:N.map((function(e){return i.a.createElement($,{key:e.propertyId,value:e.propertyId},e.name)})))))),i.a.createElement(y["a"],null,i.a.createElement(O["a"],null,i.a.createElement(E["a"].Item,Object(P["a"])({},e,{name:[e.name,"target"],fieldKey:[e.fieldKey,"target"],rules:[{required:!0,message:l.formatMessage({id:"message.edge.config.required.relative"})}]}),i.a.createElement(F["a"],{showSearch:!0,style:{width:160},placeholder:null===x||void 0===x?void 0:x.name,optionFilterProp:"children",onChange:I,onFocus:T,onBlur:R,onSearch:L,filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0}},null===M||void 0===M?void 0:M.map((function(e){return i.a.createElement($,{key:e.propertyId,value:e.propertyId},e.name)}))))))),i.a.createElement(O["a"],{span:2},i.a.createElement(A["a"],{onClick:function(){return a(e.name)}})))})),i.a.createElement(E["a"].Item,null,i.a.createElement(_["a"],{type:"dashed",onClick:function(){return n()},block:!0,icon:i.a.createElement(G["a"],null)},l.formatMessage({id:"control.edge.config.btn.add"})))))})))})),W=Object(g["b"])((function(e){var t=e.dataSourceId,n=e.className,o=e.intl,c=Object(u["b"])(t),d=Object(s["a"])((function(){return c.activeNodeInstance$})),p=Object(r["a"])(d,1),f=p[0],m=f&&f.id,g=f&&f.entity,h=f&&f.source,v=f&&f.target;return i.a.createElement("div",{className:l()(n,K.a.confPanel),hidden:e.hidden},i.a.createElement("div",{className:K.a.setting},i.a.createElement(a["a"],{defaultActiveKey:"setting",type:"card",size:"middle",tabPosition:"top",destroyInactiveTabPane:!0},i.a.createElement(a["a"].TabPane,{tab:o.formatMessage({id:"control.tab.propsettings.title"}),key:"setting"},i.a.createElement("div",{className:K.a.form},g&&i.a.createElement(B,{nodeId:m,dataSourceId:t,entity:g,intl:o}),!f&&i.a.createElement(b,{name:o.formatMessage({id:"control.tab.dssettings.title"}),intl:o,dataSourceId:t}),h&&v&&i.a.createElement(U,{dataSourceId:t,nodeId:m,source:h,target:v,intl:o,mappingProperties:null===f||void 0===f?void 0:f.mappingProperties}))))),i.a.createElement("div",{className:K.a.footer}))}))},rhp1:function(e,t,n){"use strict";n.r(t);n("B9cy");var a=n("Ol7k"),r=n("q1tI"),o=n.n(r),i=n("TSYQ"),c=n.n(i),l=n("kvAW"),s=n("qJlv"),u=n("Lyp1"),d=n("wx14"),p=n("8ub7"),f=n("xTk9"),m=n.n(f),g=function(){return o.a.createElement("svg",{width:"1cm",height:"1cm",viewBox:"0 0 124.2 133.2"},o.a.createElement("g",null,o.a.createElement("path",{fill:"#00ADEF",d:"M5.9,0.2c-3.1,0-5.7,2.6-5.7,5.7v122c0,3.1,2.6,5.7,5.7,5.7h93.3c3.1,0,5.7-2.6,5.7-5.7V5.9\r c0-3.1-2.6-5.7-5.7-5.7H5.9z M101.3,123.9c0,3.1-2.6,5.7-5.7,5.7H9.5c-3.1,0-5.7-2.6-5.7-5.7V9.9c0-3.1,2.6-5.7,5.7-5.7h86.1\r c3.1,0,5.7,2.6,5.7,5.7V123.9z"})),o.a.createElement("g",null,o.a.createElement("g",null,o.a.createElement("g",null,o.a.createElement("rect",{x:"30.3",y:"86.7",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"30.3",y:"91.8",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"30.3",y:"97",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"30.3",y:"102.1",fill:"#00ADEF",width:"3.2",height:"3.6"})),o.a.createElement("g",null,o.a.createElement("rect",{x:"25.6",y:"86.7",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"25.6",y:"91.8",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"25.6",y:"97",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"25.6",y:"102.1",fill:"#00ADEF",width:"3.2",height:"3.6"})),o.a.createElement("g",null,o.a.createElement("rect",{x:"21",y:"86.7",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"21",y:"91.8",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"21",y:"97",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"21",y:"102.1",fill:"#00ADEF",width:"3.2",height:"3.6"})),o.a.createElement("g",null,o.a.createElement("rect",{x:"16.4",y:"86.7",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"16.4",y:"91.8",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"16.4",y:"97",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"16.4",y:"102.1",fill:"#00ADEF",width:"3.2",height:"3.6"})),o.a.createElement("g",null,o.a.createElement("rect",{x:"11.8",y:"86.7",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"11.8",y:"91.8",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"11.8",y:"97",fill:"#00ADEF",width:"3.2",height:"3.6"}),o.a.createElement("rect",{x:"11.8",y:"102.1",fill:"#00ADEF",width:"3.2",height:"3.6"})))),o.a.createElement("g",null,o.a.createElement("rect",{x:"38.3",y:"95.2",fill:"#00ADEF",width:"5.2",height:"2"}),o.a.createElement("polygon",{fill:"#00ADEF",points:"43.2,93.9 43.2,98.5 45.5,96.2 \t"})),o.a.createElement("text",{transform:"matrix(0.97 0 0 1 44.4995 100.0196)",fill:"#24A2DD",fontFamily:"FZLTH8K--GBK1-0",fontSize:"16px"},"\uff5bJSON\uff5d"),o.a.createElement("g",null,o.a.createElement("path",{fill:"#00ADEF",d:"M22.3,50.4H11.8V17.5h10c11.5,0.1,17.4,5.5,17.6,16.2C39.8,45.3,34.1,50.8,22.3,50.4z M21.7,23.7h-2.5v20.9\r h2.5c6.7,0,10-3.6,10-10.8C31.5,27.2,28.2,23.8,21.7,23.7z"})))},h=function(e){return o.a.createElement(p["a"],Object(d["a"])({component:g},e))},v=function(e){e.border;return o.a.createElement("div",{className:"".concat(m.a.root," ")},o.a.createElement(h,{className:m.a.logo}))},b=n("ZGoK"),E=n.n(b),y=function(e){var t=e.datasourceName;return o.a.createElement("div",{className:E.a.wrap},o.a.createElement("span",{className:E.a.name}," ",t," "))},O=n("9kvl"),_=n("fEHO"),x=n.n(_),j=a["a"].Header,S=Object(O["b"])((function(e){var t=function(){window.open("https://help.wendocs.com/","_blank")};return o.a.createElement(o.a.Fragment,null,o.a.createElement(j,{className:c()(x.a.header)},o.a.createElement("div",{className:x.a.headerLeft},o.a.createElement(v,null),o.a.createElement(y,{datasourceName:e.name})),o.a.createElement("div",{className:x.a.headerRight},o.a.createElement("div",{className:x.a.doc},o.a.createElement("span",{style:{marginRight:16,cursor:"pointer"},onClick:t},o.a.createElement(u["a"],null)," ",e.intl.formatMessage({id:"dialog.header.btn.help"}))))))})),w=n("o0o1"),N=n.n(w),k=n("HaE+"),M=n("LtsZ"),C=Object(M["dynamic"])({loader:function(){var e=Object(k["a"])(N.a.mark((function e(){var t,a;return N.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(3),n.e(0)]).then(n.bind(null,"1QTu"));case 2:return t=e.sent,a=t.default,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}),I=Object(M["dynamic"])({loader:function(){var e=Object(k["a"])(N.a.mark((function e(){var t,a;return N.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(3),n.e(0)]).then(n.bind(null,"rCxb"));case 2:return t=e.sent,a=t.ComponentConfigPanel,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}),D=n("MgPD"),R=(n("miYZ"),n("tsqr")),T=n("ODXe"),P=(n("m6rN"),n("aMZS")),F=n("ajgr"),A=n("itvd"),G=(n("7jDW"),n("KOpF")),L=n("/MfK"),z=n("XecR");function B(e,t,n){if(e){var a=e.localToPage({x:t.x,y:t.y}),r=null===n||void 0===n?void 0:n.getBoundingClientRect();console.log(r);var o=(null===r||void 0===r?void 0:r.y)||(null===r||void 0===r?void 0:r.top)||0,i=(null===r||void 0===r?void 0:r.x)||(null===r||void 0===r?void 0:r.left)||0,c=a.y-o,l=a.x-i;return{x:l,y:c}}return{x:0,y:0}}var q,V=n("sNlH"),K=n.n(V),$=Object(O["b"])((function(e){var t=e.dataSourceId,n=e.data,a=e.intl,i=Object(r["useRef"])(null),c=Object(D["b"])(t);Object(z["a"])((function(){c.clearContextMenuInfo()}),i);var l=Object(r["useCallback"])((function(){c.deleteEdgeFromContextMenu(n.edge)}),[c,n]),s=B(c.graph,n,c.wrapper),u=s.x,d=s.y;return o.a.createElement("div",{ref:i,className:K.a.edgeContextMenu,style:{top:d,left:u}},o.a.createElement(G["a"],{hasIcon:!0},o.a.createElement(G["a"].Item,{onClick:l,icon:o.a.createElement(L["a"],null),text:a.formatMessage({id:"control.tooltip.delete"})})))})),U=n("PnDZ"),W=n("P5Jw"),Y=n("kcI3"),Q=n.n(Y),X=Object(O["b"])((function(e){var t=e.dataSourceId,n=e.data,a=e.intl,i=Object(r["useRef"])(null),c=Object(r["useRef"])(null),l=Object(D["b"])(t),s=Object(O["e"])("entity-metadata-loader"),u=s.dataSource;Object(z["a"])((function(){l.clearContextMenuInfo()}),i);var d=Object(r["useCallback"])((function(){l.clearContextMenuInfo(),c.current.click(),R["default"].success(a.formatMessage({id:"message.export.graph.success"}))}),[l,n]),p=B(l.graph,n,l.wrapper),f=p.x,m=p.y;return o.a.createElement("div",{ref:i,className:Q.a.graphContextMenu,style:{top:m,left:f}},o.a.createElement(W["CopyToClipboard"],{text:JSON.stringify(null!==u&&void 0!==u?u:{})},o.a.createElement("span",{ref:c})),o.a.createElement(G["a"],{hasIcon:!0},o.a.createElement(G["a"].Item,{icon:o.a.createElement(U["a"],null),text:a.formatMessage({id:"control.context.menu.consoledebug"}),onClick:d})))})),J=n("mxu5"),H=n("CtPC"),Z=n.n(H),ee=Object(O["b"])((function(e){var t=e.dataSourceId,n=e.data,a=e.intl,i=Object(r["useRef"])(null),c=Object(D["b"])(t),l=Object(A["a"])((function(){return c.activeNodeInstance$})),s=Object(T["a"])(l,1),u=s[0];Object(z["a"])((function(){c.clearContextMenuInfo()}),i);var d=Object(r["useCallback"])(Object(k["a"])(N.a.mark((function e(){return N.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.requestDeleteNodes([n.node.id]);case 2:case"end":return e.stop()}}),e)}))),[c,u]),p=Object(r["useCallback"])(Object(k["a"])(N.a.mark((function e(){return N.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.requestSetMainNode(n.node.id);case 2:case"end":return e.stop()}}),e)}))),[c,u]),f=B(c.graph,n,c.wrapper),m=f.x,g=f.y;return o.a.createElement("div",{ref:i,className:Z.a.graphContextMenu,style:{top:g,left:m}},o.a.createElement(G["a"],{hasIcon:!0},o.a.createElement(G["a"].Item,{onClick:p,icon:o.a.createElement(J["a"],null),text:a.formatMessage({id:"control.tooltip.setmaster"})}),o.a.createElement(G["a"].Item,{onClick:d,icon:o.a.createElement(L["a"],null),text:a.formatMessage({id:"control.tooltip.delete"})})))})),te=n("qr3z"),ne=n.n(te),ae=function(e){var t=e.dataSourceId,n=e.menuType,a=e.menuData;switch(n){case"edge":return o.a.createElement($,{dataSourceId:t,data:a});case"graph":return o.a.createElement(X,{dataSourceId:t,data:a});case"node":return o.a.createElement(ee,{dataSourceId:t,data:a});default:return null}},re=function(e){var t=e.dataSourceId,n=Object(D["b"])(t),a=Object(A["a"])((function(){return n.contextMenuInfo$})),r=Object(T["a"])(a,1),i=r[0];return(null===i||void 0===i?void 0:i.type)?o.a.createElement("div",{className:ne.a.mask},o.a.createElement(ae,{dataSourceId:t,menuData:i.data,menuType:i.type})):null},oe=(n("Q9mQ"),n("diRs")),ie=n("C/nq"),ce=n("CqGu"),le=n("Eexq"),se=n("bGsQ"),ue=n("PADK"),de=n.n(ue),pe=Object(O["b"])((function(e){var t=e.className,n=e.onZoomIn,a=e.onZoomOut,r=e.onFitContent,i=e.onRealContent,l=e.intl,s=l.formatMessage({id:"toolbar.vertical.increase"}),u=l.formatMessage({id:"toolbar.vertical.decrease"}),d=l.formatMessage({id:"toolbar.vertical.actualsize"}),p=l.formatMessage({id:"toolbar.vertical.fitcontent"});return o.a.createElement("ul",{className:c()(de.a.handler,t)},o.a.createElement(oe["a"],{overlayClassName:de.a.popover,content:s,placement:"left"},o.a.createElement("li",{onClick:n,className:de.a.item},o.a.createElement(ie["a"],null))),o.a.createElement(oe["a"],{overlayClassName:de.a.popover,content:u,placement:"left"},o.a.createElement("li",{onClick:a,className:de.a.item},o.a.createElement(ce["a"],null))),o.a.createElement(oe["a"],{overlayClassName:de.a.popover,content:d,placement:"left"},o.a.createElement("li",{onClick:i,className:de.a.item},o.a.createElement(le["a"],null))),o.a.createElement(oe["a"],{overlayClassName:de.a.popover,content:p,placement:"left"},o.a.createElement("li",{onClick:r,className:de.a.item},o.a.createElement(se["a"],null))))})),fe=n("wgzk"),me=n.n(fe),ge=Object(O["b"])((function(e){var t=e.dataSourceId,n=e.className,a=e.intl,i=Object(r["useRef"])(null),l=Object(r["useRef"])(null),s=Object(D["b"])(t);Object(r["useEffect"])((function(){s.renderGraph(i.current,l.current)}),[s]);var u=Object(P["a"])({accept:[F["a"]],drop:function(e,t){var n=t.getClientOffset(),r=t.getInitialClientOffset(),o=t.getInitialSourceClientOffset(),i=r.x-o.x,c=r.y-o.y,l=n.x-i,u=n.y-c;s.isGraphReady()?s.requestAddNode({clientX:l,clientY:u,nodeMeta:e.component,intl:a}):R["default"].info(a.formatMessage({id:"message.createtable.working"}))}}),d=Object(T["a"])(u,2),p=d[1],f=Object(r["useCallback"])((function(e){return function(){if(s.isGraphReady())switch(e){case"in":s.zoomGraph(.1);break;case"out":s.zoomGraph(-.1);break;case"fit":s.zoomGraphToFit();break;case"real":s.zoomGraphRealSize();break;default:}}}),[s]);return o.a.createElement("div",{ref:function(e){i.current=e,p(e)},className:c()(n,me.a.canvasContent)},o.a.createElement(re,{dataSourceId:t}),o.a.createElement(pe,{onZoomIn:f("in"),onZoomOut:f("out"),onFitContent:f("fit"),onRealContent:f("real"),intl:a}),o.a.createElement("div",{ref:l}))})),he=(n("oeqf"),n("M6cA")),ve=n("ga3A"),be=n("lfch"),Ee=n("9BLJ"),ye=n("3R4v"),Oe=n("IehP"),_e=n("GYYy"),xe=n("okkz"),je=n("9lW8"),Se=n.n(je),we=n("LvDl"),Ne=he["a"].Item,ke=he["a"].Group;(function(e){e["SETMASTERTABLE"]="SETMASTERTABLE",e["SAVE"]="SAVE",e["VERIFY"]="VERIFY",e["EXPORT"]="EXPORT",e["DELETE"]="DELETE",e["FULLSCREEN"]="FULLSCREEN",e["NORMALSCREEN"]="NORMALSCREEN",e["RETRUNBACK"]="RETRUNBACK"})(q||(q={}));var Me=Object(O["b"])((function(e){var t,n,a,i=e.dataSourceId,c=e.intl,l=Object(D["b"])(i),s=Object(A["a"])((function(){return l.activeNodeInstance$})),u=Object(T["a"])(s,1),d=u[0],p=Object(r["useState"])(!1),f=Object(T["a"])(p,2),m=f[0],g=f[1],h=Object(r["useState"])(!1),v=Object(T["a"])(h,2),b=v[0],E=v[1],y=Object(A["a"])((function(){return l.mainEntityId$}),""),_=Object(T["a"])(y,1),x=_[0],j=Object(O["e"])("entity-metadata-loader"),S=j.screenSize,w=j.setScreenSize,N=j.setViewType,k=j.dataSource,M=j.setDataSource,C=j.accessToken,I=Object(r["useCallback"])((function(e){switch(e){case q.SETMASTERTABLE:l.requestSetMainNode(d.id);break;case q.SAVE:g(!0),l.saveDataConfigSetting(i,C).then((function(e){if(e.success){var t=Object(we["cloneDeep"])(k);t.dataContent=e.customData,t.erMappingSchema=e.schema,t.erMappingContent=l.ERGraph$.getValue(),M(t),R["default"].success(c.formatMessage({id:"message.save.sucess"}))}g(!1)})).catch((function(e){R["default"].error(c.formatMessage({id:"message.save.failed"})),g(!1)}));break;case q.VERIFY:l.checkDatasourceConfig(),R["default"].info(c.formatMessage({id:"message.check.complete"}));break;case q.EXPORT:E(!0),(null===k||void 0===k?void 0:k.dataContent)?(R["default"].success(c.formatMessage({id:"message.export.sucess"})),E(!1)):(R["default"].error(c.formatMessage({id:"message.export.failed"})),E(!1));break;case q.DELETE:var t=l.getCellById(d.id);(null===t||void 0===t?void 0:t.isNode())?l.deleteNodes(d.id):l.deleteEdges(d.id);break;case q.FULLSCREEN:case q.NORMALSCREEN:w(e===q.FULLSCREEN?xe["c"].FullScreen:xe["c"].NormalScreen),l.resizeGraph();break;case q.RETRUNBACK:N(xe["d"].DSSetting);break;default:}}),[l,d,i,S]),P=!!d,F=x===(null===d||void 0===d?void 0:d.id),G=(null===(t=l.ERGraph$.getValue())||void 0===t||null===(n=t.nodes)||void 0===n?void 0:n.length)>0;return o.a.createElement("div",{className:Se.a.canvasToolbar},o.a.createElement(he["a"],{hoverEffect:!0,onClick:I},o.a.createElement(ke,null,o.a.createElement(Ne,{name:q.SAVE,tooltip:c.formatMessage({id:"control.tooltip.save"}),icon:o.a.createElement(ve["a"],{spin:m})})),o.a.createElement(ke,null,o.a.createElement(Ne,{name:q.SETMASTERTABLE,disabled:!(P&&!F),tooltip:c.formatMessage({id:"control.tooltip.setmaster"}),icon:o.a.createElement(J["a"],null)})),o.a.createElement(ke,null,o.a.createElement(Ne,{name:q.DELETE,disabled:!P,tooltip:c.formatMessage({id:"control.tooltip.delete"}),icon:o.a.createElement(L["a"],null)})),o.a.createElement(ke,null,o.a.createElement(W["CopyToClipboard"],{text:JSON.stringify(null!==(a=k.dataContent)&&void 0!==a?a:{})},o.a.createElement(Ne,{name:q.EXPORT,disabled:!G,tooltip:c.formatMessage({id:"control.tooltip.export"}),icon:o.a.createElement(be["a"],{spin:b})}))),o.a.createElement(ke,null,o.a.createElement(Ne,{name:q.VERIFY,tooltip:c.formatMessage({id:"control.tooltip.verify"}),icon:o.a.createElement(Ee["a"],null)})),o.a.createElement(ke,null,o.a.createElement(Ne,{name:S===xe["c"].FullScreen?q.NORMALSCREEN:q.FULLSCREEN,tooltip:S===xe["c"].NormalScreen?c.formatMessage({id:"control.tooltip.fullscreen"}):c.formatMessage({id:"control.tooltip.minisize"}),icon:S===xe["c"].NormalScreen?o.a.createElement(ye["a"],null):o.a.createElement(Oe["a"],null)})),o.a.createElement(ke,null,o.a.createElement(Ne,{name:q.RETRUNBACK,tooltip:c.formatMessage({id:"control.tooltip.back"}),icon:o.a.createElement(_e["a"],null)}))))})),Ce=(n("+L6B"),n("2/Rp")),Ie=n("QEW4"),De=n("OanE"),Re=n.n(De),Te=Object(O["b"])((function(e){var t=e.dataSourceId,n=e.isOfficeWrapped,a=e.onFinishSetting,i=e.intl,c=Object(D["b"])(t),l=Object(r["useState"])(!1),s=Object(T["a"])(l,2),u=s[0],d=s[1],p=Object(O["e"])("entity-metadata-loader"),f=p.dataSource,m=p.setDataSource,g=p.accessToken,h=Object(r["useCallback"])((function(){d(!0),c.saveDataConfigSetting(t,g).then((function(e){if(e.success){var t=Object(we["cloneDeep"])(f);t.dataContent=e.customData,t.erMappingSchema=e.schema,t.erMappingContent=c.ERGraph$.getValue(),m(t),d(!1),a&&a(t)}})).catch((function(e){R["default"].error(i.formatMessage({id:"message.save.failed"})),d(!1)}))}),[c,u]),v={content:i.formatMessage({id:"control.button.saveandexit"}),tip:i.formatMessage({id:"control.button.saveandexit.tip"}),icon:Ie["a"],disabled:!n,clickHandler:h};return o.a.createElement("div",{className:Re.a.bottomToolbar},o.a.createElement("ul",{className:Re.a.itemList},o.a.createElement("li",{className:Re.a.item},o.a.createElement(Ce["a"],{type:"dashed",disabled:v.disabled,onClick:v.clickHandler},o.a.createElement(Ie["a"],{spin:u})," ",o.a.createElement("span",null,v.content)))))})),Pe=n("97KR"),Fe=n.n(Pe),Ae=function(e){var t=e.dataSourceId,n=e.className,a=e.isOfficeWrapped,i=e.onFinishSetting,l=Object(D["b"])(t);return Object(D["c"])(t),Object(r["useEffect"])((function(){return window.renderForm=l.setActiveAlgoData,function(){delete window.renderForm}}),[l]),o.a.createElement("div",{className:c()(Fe.a.dagContainer,n)},o.a.createElement(Me,{dataSourceId:t,isOfficeWrapped:a}),o.a.createElement(ge,{dataSourceId:t,className:Fe.a.canvasContent}),o.a.createElement(Te,{dataSourceId:t,onFinishSetting:i,isOfficeWrapped:a}))},Ge=n("ozZ+"),Le=n.n(Ge),ze=(n("14J3"),n("BMrR")),Be=(n("jCWc"),n("kPKH")),qe=(n("IzEo"),n("bx4M")),Ve=(n("DYRE"),n("zeV3")),Ke=(n("7Kak"),n("9yH6")),$e=(n("y8nQ"),n("Vl3Y")),Ue=(n("5NDa"),n("5rEg")),We=(n("tU7J"),n("wFql")),Ye=(n("DZo9"),n("8z0m")),Qe=n("zbpD"),Xe=n("+YFz"),Je=n("LtfV"),He=n("fVCw"),Ze=n("bRQS"),et=n("4i/N"),tt=n("eFNv"),nt=n("x8jP"),at=n("Mo4S"),rt=n("26re"),ot=n("U+PY"),it=n("jCIX"),ct=n("2WP7"),lt=n("YXs9"),st=n.n(lt),ut=Ye["a"].Dragger,dt=We["a"].Paragraph,pt=xe["b"].DataSourceDriver,ft=xe["b"].DatabaseType,mt=function(e){var t=e.isOfficeWrapped,n=e.onFinishSettings,a=e.dataSourceId,i=e.intl,c=Object(Qe["useForm"])(),l=Object(T["a"])(c,1),s=l[0],u=Object(O["e"])("entity-metadata-loader"),d=u.dataSource,p=u.accessToken,f=u.setDataSource,m=u.setViewType,g=function(e){if(!d||!d.dataUri||0===d.dataUri.length)return"";if(d.sourceType!==pt.Database)return"";var t=d.dataUri.split(":");if("host"===e&&t.length>2)return t[2].substr(2);if("port"===e&&t.length>3){var n=/\d+/.exec(t[3]);return n&&(null===n||void 0===n?void 0:n.length)>0?n[0]:""}if("dbName"===e){var a=/databaseName=[^;&]*/.exec(t[3]);return a&&a.length>0?a[0].replace("databaseName=",""):""}if("dbUser"===e){var r=/user=[^;&]*/.exec(t[3]);return r&&r.length>0?r[0].replace("user=",""):""}if("others"===e){var o=/password=[^;&]*/.exec(t[3]),i=o&&o.length>0?o[0]:"";if(i.length>0)return t[3].substr(t[3].indexOf(i)+i.length+1)}return""},h=Object(r["useState"])(g("port")),v=Object(T["a"])(h,2),b=v[0],E=v[1],y=Object(r["useState"])(g("host")),_=Object(T["a"])(y,2),x=_[0],j=_[1],S=Object(r["useState"])(g("dbName")),w=Object(T["a"])(S,2),M=w[0],C=w[1],I=Object(r["useState"])(g("dbUser")),D=Object(T["a"])(I,2),P=D[0],F=D[1],A=Object(r["useState"])(g("dbPwd")),G=Object(T["a"])(A,2),L=G[0],z=G[1],B=Object(r["useState"])(g("others")),q=Object(T["a"])(B,2),V=q[0],K=q[1],$=Object(r["useState"])(""),U=Object(T["a"])($,2),W=U[0],Y=(U[1],function(e){var t;if(e.sourceType===pt.Database){var n=x&&x.length>0&&b&&b.length>0&&M&&M.length>0;return!!n}return!!(e.dataUri&&(null===(t=e.dataUri)||void 0===t?void 0:t.length)>0)}),Q=function(e){var t,n=e&&(null===(t=e.dataSourceName)||void 0===t?void 0:t.length)>0&&Y(e);return!!n},X=Object(r["useState"])(Q(d)),J=Object(T["a"])(X,2),H=J[0],Z=J[1],ee=function(){var e=Object(k["a"])(N.a.mark((function e(t){var n,a;return N.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.sourceType===pt.JsonFile&&t.dataUri&&t.dataUri.length>0)){e.next=5;break}return e.next=3,ct["a"].getInstance().getJsonFileContent(t.dataUri,p);case 3:n=e.sent,t.dataContent=n;case 5:t.sourceType===pt.Database&&(t.databaseType||(t.databaseType=ft.MySQL),a=ae(),a!==d.dataUri&&(t.dataUri=a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=Object(k["a"])(N.a.mark((function e(t){var n,r;return N.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Object.assign({},d,t),n.dataSourceId!=a&&(n.dataSourceId=a),e.prev=2,!t.sourceType){e.next=8;break}n.dataUri="",t.sourceType!==xe["b"].DataSourceDriver.Database||n.databaseType||(n.databaseType=xe["b"].DatabaseType.MySQL),e.next=10;break;case 8:return e.next=10,ee(n);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](2),R["default"].error(i.formatMessage({id:"message.loadcontent.error",error:e.t0}));case 15:r=Q(n),Z(r),f(n);case 18:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ft.MySQL;return e===ft.SQLServer?"jdbc:sqlserver://":"jdbc:mysql://"},ae=function(){var e="";return d.databaseType===ft.SQLServer?(e=ne(ft.SQLServer).concat(x).concat(":").concat(b).concat(";").concat("databaseName=").concat(M).concat(";").concat("user=").concat(P).concat(";").concat("password=").concat(L).concat(";"),V&&V.length>0&&(e=e.concat(V).concat(";")),e):(e=ne(ft.MySQL).concat(x).concat(":").concat(b).concat("?").concat("database=").concat(M).concat("&").concat("username=").concat(P).concat("&").concat("password=").concat(L),V&&V.length>0&&(e=e.concat("&").concat(V)),e)},re=function(e){var t=e.name.endsWith(".js")||e.name.endsWith(".json")||e.name.endsWith(".txt")||"text/javascript"===e.type||"text/plain"===e.type||"application/json"===e.type,n=e.name.endsWith(".xls")||e.name.endsWith(".xlsx")||"application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type,a=d.sourceType===pt.JsonFile?t:n;a||R["default"].error(i.formatMessage({id:"message.filetype.invalid"}));var r=e.size/1024<128;return r||R["default"].error(i.formatMessage({id:"message.filetype.toolarge"})),a&&r},oe=function(e){if(e===pt.Excel||e===pt.JsonFile){var t=d.dataUri&&d.dataUri.length>0?[{uid:d.dataSourceId,name:d.dataUri.substr(d.dataUri.lastIndexOf("/")+1),url:d.dataUri,size:0,type:e===pt.Excel?"application/vnd.ms-excel":"application/json"}]:[],n=i.formatMessage({id:"message.upload.label"}),a=i.formatMessage({id:"message.upload.tooltip"}),r=i.formatMessage({id:"message.upload.content.label"}),c=i.formatMessage({id:"message.upload.content.desc"}),l={name:"fileData",multiple:!1,defaultFileList:t,headers:{Authorization:"Bearer "+p},beforeUpload:re,action:it["e"],maxCount:1,onChange:function(e){var t=i.formatMessage({id:"message.upload.msg.success"},{fileName:e.file.name}),n=i.formatMessage({id:"message.upload.msg.error"},{fileName:e.file.name}),a=e.file,r=a.status,o=a.response;"uploading"!==r&&console.log(e.file,e.fileList),"done"===r?(te({dataUri:o}),R["default"].success(t)):"error"===r&&R["default"].error(n)}};return o.a.createElement($e["a"].Item,{required:!0,label:n,name:"dataUri",tooltip:{title:a,icon:o.a.createElement(Xe["a"],null)}},o.a.createElement(Ue["a"],{hidden:!0}),o.a.createElement(ut,l,o.a.createElement("p",{className:"ant-upload-drag-icon"},o.a.createElement(Je["a"],null)),o.a.createElement("p",{className:"ant-upload-text"},r),o.a.createElement("p",{className:"ant-upload-hint"},c)))}if(e===pt.Database){var s=i.formatMessage({id:"control.field.dbtype.label"}),u=i.formatMessage({id:"control.field.dbtype.tooltip"}),f=i.formatMessage({id:"control.field.jdbc.label"}),m=i.formatMessage({id:"control.field.jdbc.tooltip"}),g=i.formatMessage({id:"control.field.plc.server"}),h=i.formatMessage({id:"control.field.plc.port"}),v=i.formatMessage({id:"control.field.plc.dbname"}),y=i.formatMessage({id:"control.field.plc.dbuname"}),O=i.formatMessage({id:"control.field.plc.dbpwd"}),_=i.formatMessage({id:"control.field.plc.dbothers"});return o.a.createElement(o.a.Fragment,null,o.a.createElement($e["a"].Item,{label:s,name:"databaseType",required:!0,tooltip:u},o.a.createElement(Ke["a"].Group,{defaultValue:d.databaseType},o.a.createElement(Ke["a"],{value:ft.MySQL},"MySQL"),o.a.createElement(Ke["a"],{value:ft.SQLServer},"SQL Server"),o.a.createElement(Ke["a"],{disabled:!0,value:ft.Oracle},"Oracle"))),o.a.createElement($e["a"].Item,{label:f,required:!0,tooltip:m},o.a.createElement(Ue["a"].Group,{compact:!0,onBlur:function(){return te({})}},o.a.createElement(Ue["a"],{addonBefore:ne(d.databaseType),onChange:function(e){e.preventDefault(),j(e.target.value)},defaultValue:x,placeholder:g,style:{width:"30%"}}),o.a.createElement(Ue["a"],{style:{width:"10%"},onChange:function(e){e.preventDefault(),E(e.target.value)},addonBefore:":",placeholder:h,defaultValue:b}),o.a.createElement(Ue["a"],{style:{width:"15%"},placeholder:v,onChange:function(e){e.preventDefault(),C(e.target.value)},defaultValue:M}),o.a.createElement(Ue["a"],{style:{width:"15%"},placeholder:y,onChange:function(e){e.preventDefault(),F(e.target.value)},defaultValue:P}),o.a.createElement(Ue["a"],{style:{width:"15%"},placeholder:O,type:"password",onChange:function(e){e.preventDefault(),z(e.target.value)},defaultValue:L}),o.a.createElement(Ue["a"],{style:{width:"15%"},placeholder:_,onChange:function(e){e.preventDefault(),K(e.target.value)},defaultValue:V}))))}if(e===pt.OData){var S=i.formatMessage({id:"control.field.odata.label"}),w=i.formatMessage({id:"control.field.odata.desc"}),N=i.formatMessage({id:"control.field.plc.odata"});return o.a.createElement($e["a"].Item,{label:S,required:!0,tooltip:w},o.a.createElement(Ue["a"],{onChange:function(e){te({dataUri:e.target.value})},defaultValue:W,placeholder:N}))}return o.a.createElement(o.a.Fragment,null)},ie=function(e){if(e===pt.Excel||e===pt.Database||e===pt.OData){var t=i.formatMessage({id:"message.dmapping.info"}),n=i.formatMessage({id:"control.button.mapping"});return o.a.createElement("div",{className:st.a.tablemappinglink},o.a.createElement(dt,{strong:!0},t,o.a.createElement(Ce["a"],{type:"primary",className:st.a.btnermapping,disabled:!H,onClick:function(){m(xe["d"].DSConfigMain)}},o.a.createElement(He["a"],null),n)))}return o.a.createElement(o.a.Fragment,null)},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(n){if(e)return void n({cancel:!0});n(d)}},le=!d.dataContent,se=i.formatMessage({id:"control.button.confirm"}),ue=i.formatMessage({id:"control.button.cancel"}),de=i.formatMessage({id:"dlg.settings.title"}),pe=i.formatMessage({id:"control.field.dsname"}),fe=i.formatMessage({id:"control.field.dsname.plc"}),me=i.formatMessage({id:"control.field.dsname.tooltip"}),ge=i.formatMessage({id:"control.field.dstype"}),he=i.formatMessage({id:"control.field.dsjson"}),ve=i.formatMessage({id:"control.field.dsexcel"}),be=i.formatMessage({id:"control.field.dsdb"}),Ee=i.formatMessage({id:"control.field.dsodata"}),ye=t?[o.a.createElement(Ve["b"],{split:!0},o.a.createElement(Ce["a"],{type:"dashed",onClick:function(){return ce(!1)},disabled:le},o.a.createElement(Ze["a"],null)," ",se),o.a.createElement(Ce["a"],{type:"dashed",onClick:function(){return ce(!0)}},o.a.createElement(et["a"],null)," ",ue))]:void 0;return o.a.createElement(ze["a"],{justify:"center",align:"middle",className:st.a.settingscontainer},o.a.createElement(Be["a"],{className:st.a.settingcard},o.a.createElement(qe["a"],{title:o.a.createElement("div",null,o.a.createElement(tt["a"],null),de),actions:ye},o.a.createElement($e["a"],{form:s,layout:"vertical",initialValues:d,onValuesChange:te},o.a.createElement($e["a"].Item,{label:ge,required:!0,name:"sourceType"},o.a.createElement(Ke["a"].Group,{defaultValue:d.sourceType},o.a.createElement(Ke["a"].Button,{value:pt.JsonFile},o.a.createElement(nt["a"],null)," ",he),o.a.createElement(Ke["a"].Button,{value:pt.Excel},o.a.createElement(at["a"],null)," ",ve),o.a.createElement(Ke["a"].Button,{value:pt.Database},o.a.createElement(rt["a"],null)," ",be),o.a.createElement(Ke["a"].Button,{value:pt.OData},o.a.createElement(ot["a"],null)," ",Ee," "))),o.a.createElement($e["a"].Item,{label:pe,name:"dataSourceName",required:!0,tooltip:me},o.a.createElement(Ue["a"],{placeholder:fe})),oe(d.sourceType),ie(d.sourceType)))))},gt=Object(O["b"])(mt),ht=n("5Bhb"),vt=n.n(ht),bt=function(){return o.a.createElement("svg",{width:"2.5em",height:"2.5em",version:"1.1",id:"\u56fe\u5c42_1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",viewBox:"0 0 386 442"},o.a.createElement("g",null,o.a.createElement("path",{fill:"#3A8DDE",d:"M178.3,136.5v155.1c0,0-42.1-35.4-88.6-37.7l-9.8-148.4C79.9,105.5,140.6,105.5,178.3,136.5z"}),o.a.createElement("path",{fill:"#3A8DDE",d:"M59.9,114.4l11.1-6.6L80.8,265c0,0,39.9-6.6,82,26.6c0,0-53.2-24.4-93-15.5L59.9,114.4z"}),o.a.createElement("path",{fill:"#3A8DDE",d:"M184.9,136.5v155.1c0,0,42.1-35.4,88.6-37.7l9.8-148.4C283.3,105.5,222.6,105.5,184.9,136.5z"}),o.a.createElement("path",{fill:"#3A8DDE",d:"M303.3,114.4l-11.1-6.6L282.4,265c0,0-39.9-6.6-82,26.6c0,0,53.2-24.4,93-15.5L303.3,114.4z"})),o.a.createElement("path",{fill:"#fff",d:"M218,234.2h-72.8c-13.2,0-24-10.8-24-24c0-12.2,9.1-22.3,21-23.8c3.1-9.9,12.3-16.7,22.9-16.7\r c3.5,0,6.9,0.8,10.1,2.2c5.4-7.3,13.9-11.7,23.1-11.7c15.5,0,28.2,12.3,28.7,27.7c9.1,3.6,15.1,12.3,15.1,22.3\r C242,223.4,231.2,234.2,218,234.2z"}),o.a.createElement("text",{transform:"matrix(0.94 0 0 1 117.212 336.1904)",fontSize:"1em"},"\u534e\u6587\u4e91\u9053"))},Et=function(e){return o.a.createElement(p["a"],Object(d["a"])({component:bt},e))},yt=a["a"].Footer,Ot=Object(O["b"])((function(e){return e.show?o.a.createElement(o.a.Fragment,null,o.a.createElement(yt,{className:c()(vt.a.footer)},o.a.createElement("div",{className:vt.a.footer},o.a.createElement(Et,{className:vt.a.logo}),e.intl.formatMessage({id:"control.footer.copyright"},{year:(new Date).getFullYear().toString()})))):null})),_t=a["a"].Content,xt=function(e){var t=e.isOfficeWrapped,n=e.onFinishSetting,r=e.intl,i=Object(O["e"])("entity-metadata-loader"),u=i.currentViewType,d=i.dataSource,p=i.screenSize;Object(D["a"])(d);var f=r.formatMessage({id:"form.dsconfig.title"});return o.a.createElement(a["a"],{className:Le.a.layout},o.a.createElement(S,{name:f,intl:r}),o.a.createElement(_t,{className:Le.a.content},u===xe["d"].DSSetting&&o.a.createElement(gt,{isOfficeWrapped:t,dataSourceId:d.dataSourceId,onFinishSettings:n}),u===xe["d"].DSConfigMain&&o.a.createElement("div",{className:c()(Le.a.datasource)},o.a.createElement(l["a"],{backend:s["a"]},o.a.createElement(C,{dataSourceId:d.dataSourceId,className:Le.a.nodeSourceTree,hidden:p===xe["c"].FullScreen}),o.a.createElement("div",{className:Le.a.editPanel},o.a.createElement(Ae,{dataSourceId:d.dataSourceId,onFinishSetting:n,isOfficeWrapped:t})),o.a.createElement(I,{className:Le.a.confPanel,dataSourceId:d.dataSourceId,hidden:p===xe["c"].FullScreen,intl:r})))),o.a.createElement(Ot,{intl:r,show:u===xe["d"].DSSetting}))};t["default"]=Object(O["b"])(xt)},sNlH:function(e,t,n){e.exports={edgeContextMenu:"edgeContextMenu___2EUPJ"}},uzJG:function(e,t,n){},wgzk:function(e,t,n){e.exports={canvasContent:"canvasContent___BRTNQ",runningStatus:"runningStatus___2RnXM"}},xTk9:function(e,t,n){e.exports={root:"root___1dqOr",logo:"logo___1Jk9n",dash:"dash___s2NjP"}}}]);